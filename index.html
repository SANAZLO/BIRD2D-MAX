<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eagle Storm: Day & Night Edition</title>
    <style>
        :root { --gold: #f1c40f; --bg: #020617; }<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Ğ‘ÑƒÑ€Ñ ĞÑ€Ğ»Ğ¾Ğ²</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{width:100%;height:100%;overflow:hidden;background:#000;touch-action:none;font-family:'Segoe UI',Arial,sans-serif}
canvas{display:block;position:fixed;top:0;left:0}

/* â”€â”€ ĞŸĞĞ’Ğ•Ğ ĞĞ£Ğ¢Ğ¬ Ğ­ĞšĞ ĞĞ â”€â”€ */
#rotate{display:none;position:fixed;inset:0;z-index:9999;background:#05080f;
  flex-direction:column;align-items:center;justify-content:center;gap:20px;text-align:center}
#rotate-icon{font-size:72px;animation:rtilt 1.5s ease-in-out infinite alternate}
@keyframes rtilt{from{transform:rotate(-30deg)}to{transform:rotate(30deg)}}
#rotate p{color:#f1c40f;font-size:20px;font-weight:700;letter-spacing:2px;padding:0 20px}

/* â”€â”€ ĞœĞ•ĞĞ® Ğ’Ğ«Ğ‘ĞĞ Ğ ĞŸĞ¢Ğ˜Ğ¦Ğ« â€” Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ²ÑĞµĞ³Ğ¾ â”€â”€ */
#menu{position:fixed;inset:0;z-index:500;background:rgba(3,6,18,.95);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0;padding:16px}

.sel-title{font-size:clamp(28px,6vw,48px);font-weight:900;letter-spacing:3px;
  background:linear-gradient(135deg,#f1c40f,#e67e22);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:4px;text-align:center}
.sel-sub{font-size:12px;letter-spacing:5px;color:rgba(255,255,255,.35);margin-bottom:16px;text-align:center}

.sel-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
  width:100%;max-width:680px;margin-bottom:16px}
.sel-card{background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.12);
  border-radius:14px;padding:10px 6px 8px;cursor:pointer;transition:.2s;text-align:center}
.sel-card:hover{border-color:rgba(241,196,15,.7);transform:translateY(-3px)}
.sel-card.active{border-color:#f1c40f;background:rgba(241,196,15,.1)}
.sel-card canvas{display:block;margin:0 auto 6px;width:54px;height:54px}
.sel-card .cname{font-size:11px;font-weight:700;letter-spacing:1px;color:rgba(255,255,255,.7)}
.sel-card.active .cname{color:#f1c40f}
.sel-card .ctag{font-size:9px;color:rgba(255,255,255,.3);margin-top:2px}

.sel-name-row{display:flex;gap:10px;align-items:center;margin-bottom:14px;width:100%;max-width:500px}
.sel-name-row input{flex:1;padding:12px 16px;border-radius:10px;
  border:2px solid rgba(241,196,15,.3);background:rgba(255,255,255,.07);
  color:#fff;font-size:16px;font-weight:700;outline:none;text-align:center;
  font-family:inherit;transition:.2s}
.sel-name-row input:focus{border-color:#f1c40f;box-shadow:0 0 14px rgba(241,196,15,.25)}
.sel-name-row input::placeholder{color:rgba(255,255,255,.3)}

.sel-btns{display:flex;gap:12px;width:100%;max-width:500px}
.btn-play{flex:2;padding:15px;border:none;border-radius:12px;
  background:linear-gradient(135deg,#f1c40f,#e67e22);
  color:#000;font-size:18px;font-weight:900;letter-spacing:2px;cursor:pointer;transition:.2s}
.btn-play:hover{transform:scale(1.03);box-shadow:0 0 24px rgba(241,196,15,.5)}
.btn-play:active{transform:scale(.97)}
.btn-anon{flex:1;padding:15px;border:1px solid rgba(255,255,255,.2);border-radius:12px;
  background:rgba(255,255,255,.07);color:rgba(255,255,255,.7);
  font-size:14px;font-weight:700;letter-spacing:1px;cursor:pointer;transition:.2s}
.btn-anon:hover{background:rgba(255,255,255,.14)}

/* â”€â”€ GAME OVER â€” Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ²ÑĞµĞ³Ğ¾ â”€â”€ */
#gameover{position:fixed;inset:0;z-index:500;display:none;
  background:rgba(3,6,18,.93);backdrop-filter:blur(12px);
  flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:20px}
.go-title{font-size:clamp(36px,9vw,64px);font-weight:900;
  color:#e74c3c;text-shadow:0 0 30px rgba(231,76,60,.7)}
.go-score{font-size:clamp(24px,5vw,40px);font-weight:900;color:#f1c40f}
.go-best{font-size:13px;color:rgba(255,255,255,.4);letter-spacing:2px}
.go-lb{width:100%;max-width:440px;background:rgba(0,0,0,.4);
  border:1px solid rgba(255,255,255,.1);border-radius:12px;overflow:hidden}
.go-lb-head{padding:8px 14px;background:rgba(241,196,15,.08);
  font-size:11px;letter-spacing:4px;color:#f1c40f;font-weight:700;
  border-bottom:1px solid rgba(241,196,15,.12)}
.lb-row{display:flex;align-items:center;gap:8px;padding:7px 14px;
  border-bottom:1px solid rgba(255,255,255,.04);font-size:13px;font-weight:600}
.lb-row:last-child{border-bottom:none}
.lb-me{background:rgba(241,196,15,.07)}
.lb-rank{width:22px;font-size:15px;text-align:center}
.lb-icon{font-size:16px}
.lb-name{flex:1;color:rgba(255,255,255,.8)}
.lb-name.me{color:#f1c40f}
.lb-pts{color:#f1c40f;font-weight:900;font-size:15px}
.go-btns{display:flex;gap:12px}
.btn-again{padding:14px 32px;border:none;border-radius:12px;
  background:linear-gradient(135deg,#2ecc71,#16a085);
  color:#fff;font-size:16px;font-weight:900;letter-spacing:2px;cursor:pointer;transition:.2s}
.btn-again:hover{transform:scale(1.04)}
.btn-again:active{transform:scale(.96)}
.btn-back{padding:14px 24px;border:1px solid rgba(255,255,255,.2);border-radius:12px;
  background:rgba(255,255,255,.08);color:#fff;font-size:16px;font-weight:700;
  letter-spacing:1px;cursor:pointer;transition:.2s}
.btn-back:hover{background:rgba(255,255,255,.15)}
.btn-back:active{transform:scale(.96)}

/* â”€â”€ HUD â”€â”€ */
#hud{position:fixed;top:0;left:0;right:0;z-index:100;pointer-events:none;
  display:none;align-items:flex-start;justify-content:space-between;padding:10px 18px}
#hud-score{font-size:clamp(30px,6vw,52px);font-weight:900;
  color:#f1c40f;text-shadow:0 0 18px rgba(241,196,15,.8),0 2px 4px #000;line-height:1}
#hud-label{font-size:10px;letter-spacing:3px;color:rgba(255,255,255,.4);margin-top:2px}
#hud-combo{font-size:clamp(14px,2.5vw,22px);color:#e74c3c;font-weight:900;
  text-shadow:0 0 12px rgba(231,76,60,.9);opacity:0;transition:opacity .3s;text-align:right}
#speedbar{position:fixed;bottom:0;left:0;right:0;height:4px;z-index:100;
  background:rgba(255,255,255,.1);display:none}
#speedbar-fill{height:100%;width:0%;background:linear-gradient(90deg,#2ecc71,#f1c40f,#e74c3c);transition:width .5s}

@media(max-width:600px){
  .sel-grid{gap:7px}
  .sel-card canvas{width:44px;height:44px}
  .sel-btns{flex-direction:column}
  .go-btns{flex-direction:column;width:100%;max-width:300px}
  .btn-again,.btn-back{width:100%}
}
@media(max-height:400px){
  .sel-card{padding:6px 4px 4px}
  .sel-card canvas{width:38px;height:38px}
  .sel-sub{margin-bottom:8px}
  .sel-name-row{margin-bottom:8px}
}
</style>
</head>
<body>

<div id="rotate">
  <div id="rotate-icon">ğŸ“±</div>
  <p>ĞŸĞĞ’Ğ•Ğ ĞĞ˜ Ğ¢Ğ•Ğ›Ğ•Ğ¤ĞĞ<br>Ğ“ĞĞ Ğ˜Ğ—ĞĞĞ¢ĞĞ›Ğ¬ĞĞ</p>
</div>

<!-- Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ CANVAS â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ…Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸Ğ³Ñ€Ñ‹ -->
<canvas id="c"></canvas>

<!-- ĞœĞ•ĞĞ® Ğ’Ğ«Ğ‘ĞĞ Ğ ĞŸĞ¢Ğ˜Ğ¦Ğ« -->
<div id="menu">
  <div class="sel-title">ğŸ¦… Ğ‘Ğ£Ğ Ğ¯ ĞĞ Ğ›ĞĞ’</div>
  <div class="sel-sub">Ğ’Ğ«Ğ‘Ğ•Ğ Ğ˜ ĞŸĞ¢Ğ˜Ğ¦Ğ£ â€” Ğ›Ğ•Ğ¢Ğ˜ â€” ĞŸĞĞ‘Ğ•Ğ–Ğ”ĞĞ™</div>
  <div class="sel-grid" id="sel-grid"></div>
  <div class="sel-name-row">
    <input type="text" id="inp-name" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸ Ğ¸Ğ¼Ñ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)"
           maxlength="12" autocomplete="off" autocorrect="off" spellcheck="false">
  </div>
  <div class="sel-btns">
    <button class="btn-play" onclick="clickPlay()">â–¶ Ğ˜Ğ“Ğ ĞĞ¢Ğ¬</button>
    <button class="btn-anon" onclick="clickAnon()">Ğ‘ĞµĞ· Ğ¸Ğ¼ĞµĞ½Ğ¸</button>
  </div>
</div>

<!-- GAME OVER -->
<div id="gameover">
  <div class="go-title">ğŸ’¥ ĞšĞ Ğ£Ğ¨Ğ•ĞĞ˜Ğ•!</div>
  <div class="go-score" id="go-score">0 ĞĞ§ĞšĞĞ’</div>
  <div class="go-best"  id="go-best"></div>
  <div class="go-lb">
    <div class="go-lb-head">ğŸ† Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ Ğ Ğ•ĞšĞĞ Ğ”ĞĞ’</div>
    <div id="lb-rows"></div>
  </div>
  <div class="go-btns">
    <button class="btn-again" onclick="clickAgain()">â†» Ğ•Ğ©Ğ Ğ ĞĞ—</button>
    <button class="btn-back"  onclick="clickMenu()">âŒ‚ ĞœĞ•ĞĞ®</button>
  </div>
</div>

<!-- HUD -->
<div id="hud">
  <div>
    <div id="hud-score">0</div>
    <div id="hud-label">ĞĞ§ĞšĞ˜</div>
  </div>
  <div id="hud-combo"></div>
</div>
<div id="speedbar"><div id="speedbar-fill"></div></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ¢Ğ˜Ğ¦Ğ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BIRDS=[
  {id:'eagle',  name:'ĞĞ ĞĞ›',      tag:'ĞšĞ›ĞĞ¡Ğ¡Ğ˜ĞšĞ', emoji:'ğŸ¦…',body:'#5d4037',wing:'#3e2723',head:'#fff8e1',beak:'#f59e0b',eye:'#111',  aura:null,       trail:'rgba(139,90,43,.4)'},
  {id:'phoenix',name:'Ğ¤Ğ•ĞĞ˜ĞšĞ¡',    tag:'ĞĞ“ĞĞĞ¬',    emoji:'ğŸ”¥',body:'#e74c3c',wing:'#922b21',head:'#f39c12',beak:'#e67e22',eye:'#fff',  aura:'#ff6b35',  trail:'rgba(231,76,60,.5)'},
  {id:'raven',  name:'Ğ’ĞĞ ĞĞ',     tag:'Ğ¢Ğ•ĞĞ¬',     emoji:'ğŸ¦',body:'#1a1a2e',wing:'#0d0d1a',head:'#2c2c54',beak:'#95a5a6',eye:'#6c5ce7',aura:'#6c5ce7', trail:'rgba(108,92,231,.4)'},
  {id:'falcon', name:'Ğ¡ĞĞšĞĞ›',     tag:'Ğ¡ĞšĞĞ ĞĞ¡Ğ¢Ğ¬', emoji:'ğŸ¦…',body:'#2c3e50',wing:'#1a252f',head:'#ecf0f1',beak:'#e67e22',eye:'#e74c3c',aura:'#3498db', trail:'rgba(52,73,94,.4)'},
  {id:'parrot', name:'ĞŸĞĞŸĞ£Ğ“ĞĞ™',   tag:'Ğ£Ğ”ĞĞ§Ğ',    emoji:'ğŸ¦œ',body:'#27ae60',wing:'#1e8449',head:'#f1c40f',beak:'#e74c3c',eye:'#fff',  aura:'#f1c40f',  trail:'rgba(39,174,96,.4)'},
  {id:'storm',  name:'Ğ‘Ğ£Ğ Ğ•Ğ’Ğ•Ğ¡Ğ¢.', tag:'Ğ›Ğ•Ğ“Ğ•ĞĞ”Ğ',  emoji:'âš¡',body:'#7f8c8d',wing:'#636e72',head:'#dfe6e9',beak:'#fdcb6e',eye:'#6c5ce7',aura:'#fdcb6e', trail:'rgba(127,140,141,.5)'},
  {id:'ice',    name:'Ğ›Ğ•Ğ”Ğ¯ĞĞĞ™',   tag:'ĞĞ ĞšĞ¢Ğ˜ĞšĞ',  emoji:'â„ï¸',body:'#74b9ff',wing:'#0984e3',head:'#dfe6e9',beak:'#b2bec3',eye:'#111',  aura:'#74b9ff',  trail:'rgba(116,185,255,.5)'},
  {id:'golden', name:'Ğ—ĞĞ›ĞĞ¢ĞĞ™',   tag:'Ğ Ğ•Ğ”ĞšĞ˜Ğ™',   emoji:'âœ¨',body:'#f1c40f',wing:'#e67e22',head:'#fffde7',beak:'#e67e22',eye:'#2d3436',aura:'#f1c40f', trail:'rgba(241,196,15,.6)'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CV = document.getElementById('c');
const CX = CV.getContext('2d');

// rrect â€” Ğ·Ğ°Ğ¼ĞµĞ½Ğ° roundRect (Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¾Ğ²)
// r Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ¼ [tl,tr,br,bl]
function rrect(ctx,x,y,w,h,r){
  var tl,tr,br,bl;
  if(Array.isArray(r)){
    tl=r[0]||0; tr=r[1]||0; br=r[2]||0; bl=r[3]||0;
  } else {
    tl=tr=br=bl=r||0;
  }
  ctx.beginPath();
  ctx.moveTo(x+tl,y);
  ctx.lineTo(x+w-tr,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+tr);
  ctx.lineTo(x+w,y+h-br);
  ctx.quadraticCurveTo(x+w,y+h,x+w-br,y+h);
  ctx.lineTo(x+bl,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-bl);
  ctx.lineTo(x,y+tl);
  ctx.quadraticCurveTo(x,y,x+tl,y);
  ctx.closePath();
}


let W=0, H=0;

function resize(){
  W = CV.width  = window.innerWidth;
  H = CV.height = window.innerHeight;
  recalcPhysics();
  checkRotate();
}
window.addEventListener('resize', resize);
window.addEventListener('orientationchange', ()=>setTimeout(resize,250));

function checkRotate(){
  const mob = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  document.getElementById('rotate').style.display =
    (mob && window.innerHeight > window.innerWidth) ? 'flex' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¤Ğ˜Ğ—Ğ˜ĞšĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let GRAV, JUMP, SPEED, GAP, PIPE_INT;
function recalcPhysics(){
  const sc = Math.min(W, H*16/9) / 800;
  GRAV     = 0.20 * sc;
  JUMP     = -5.5 * sc;
  SPEED    = 3.0  * sc;
  GAP      = Math.max(150, 230*(H/450));
  PIPE_INT = Math.round(110/sc);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ•
// STATE: 'menu' | 'countdown' | 'ready' | 'playing' | 'over'
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let STATE = 'menu';
let birdIdx = 0;
let playerName = 'Ğ˜Ğ“Ğ ĞĞš';

let bird, pipes, trails, particles;
let score, frame, combo, comboTimer;
let cycleDayNight = 0.55, lightFlash = 0;
let stars, clouds, mountains;

// ĞÑ‚ÑÑ‡Ñ‘Ñ‚ â€” Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² ÑÑ‚Ğ¸Ñ… Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…
let cdNum = 0;       // Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ñ‡Ğ¸ÑĞ»Ğ¾ 3/2/1
let cdTimer = null;  // handle setTimeout

// ĞœĞ¸Ğ³Ğ°Ğ½Ğ¸Ğµ "tap to fly"
let tapBlink = 0;

// Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸
let level = 1;
let lastLevelScore = 0; // ÑÑ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¼ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ ĞœĞ˜Ğ Ğ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initWorld(){
  recalcPhysics();
  bird = {x:W*0.22, y:H/2, v:0, wing:0};
  pipes=[];trails=[];particles=[];
  score=0; frame=0; combo=0; comboTimer=0; level=1; lastLevelScore=0;
  lightFlash=0; tapBlink=0;

  document.getElementById('hud-score').textContent = '0';
  document.getElementById('hud-combo').style.opacity = '0';
  document.getElementById('speedbar-fill').style.width = '0%';

  stars = Array.from({length:90},()=>({
    x:Math.random()*W, y:Math.random()*H*.65,
    r:.5+Math.random()*1.8, tw:Math.random()*Math.PI*2
  }));
  clouds = Array.from({length:7},()=>({
    x:Math.random()*W, y:30+Math.random()*H*.38,
    s:.5+Math.random()*.9, sp:.25+Math.random()*.35
  }));
  mountains = [0,1,2].map(li=>{
    const cnt=10+li*4;
    return {sp:(li+1)*.35, li,
      pts:Array.from({length:cnt+1},(_,i)=>({
        x:(W/cnt)*i,
        y:H*(.52+li*.13)-Math.random()*H*(.18-li*.04)
      }))
    };
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ’Ğ¡ĞŸĞĞœĞĞ“ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ• DOM-Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showEl(id){ document.getElementById(id).style.display='flex'; }
function hideEl(id){ document.getElementById(id).style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞšĞĞĞŸĞšĞ˜ ĞœĞ•ĞĞ®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function clickPlay(){
  const nm = document.getElementById('inp-name').value.trim();
  playerName = nm || 'Ğ˜Ğ“Ğ ĞĞš';
  beginCountdown();
}
function clickAnon(){
  playerName = 'Ğ˜Ğ“Ğ ĞĞš';
  beginCountdown();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞĞ¢Ğ¡Ğ§ĞĞ¢ 3-2-1 (Ñ€Ğ¸ÑÑƒĞµÑ‚ÑÑ ĞĞ CANVAS, Ğ½Ğµ HTML)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function beginCountdown(){
  if(cdTimer) clearTimeout(cdTimer);
  hideEl('menu');
  hideEl('gameover');
  hideEl('hud');
  document.getElementById('speedbar').style.display = 'none';
  initWorld();
  cdNum = 3;
  STATE = 'countdown';
  scheduleNextTick();
}

function scheduleNextTick(){
  cdTimer = setTimeout(cdTick, 1000);
}

function cdTick(){
  cdNum--;
  if(cdNum > 0){
    scheduleNextTick();
  } else {
    // ĞÑ‚ÑÑ‡Ñ‘Ñ‚ ĞºĞ¾Ğ½Ñ‡Ğ¸Ğ»ÑÑ â†’ STATE = ready
    cdTimer = null;
    STATE = 'ready';
    tapBlink = 0;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ•
// Ğ¢Ğ°Ğ¿Ñ‹/ĞºĞ»Ğ¸ĞºĞ¸/Ğ¿Ñ€Ğ¾Ğ±ĞµĞ» â€” Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½Ğ° canvas
// ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… HTML-Ğ¾Ğ²ĞµÑ€Ğ»ĞµĞµĞ² Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼ Ğ¸ canvas Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ countdown/ready/playing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onTap(e){
  if(e) e.preventDefault();

  if(STATE === 'countdown'){
    // ĞĞ°Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ÑÑ‡Ñ‘Ñ‚Ğ° â€” ÑƒÑĞºĞ¾Ñ€ÑĞµĞ¼, Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ ÑÑ€Ğ°Ğ·Ñƒ Ğ² ready
    if(cdTimer){ clearTimeout(cdTimer); cdTimer=null; }
    STATE = 'ready';
    tapBlink = 0;
    return;
  }

  if(STATE === 'ready'){
    // ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ñ‚Ğ°Ğ¿ â€” ÑÑ‚Ğ°Ñ€Ñ‚ Ğ¸Ğ³Ñ€Ñ‹
    STATE = 'playing';
    frame = 0;
    showEl('hud');
    document.getElementById('speedbar').style.display = 'block';
    doFlap();
    return;
  }

  if(STATE === 'playing'){
    doFlap();
  }
}

function doFlap(){
  bird.v = JUMP;
  const b = BIRDS[birdIdx];
  for(let i=0;i<5;i++) particles.push({
    x:bird.x-12, y:bird.y+4,
    vx:-Math.random()*2.5, vy:(Math.random()-.5)*3,
    r:2+Math.random()*2, col:b.trail, life:1
  });
}

// Ğ¡Ğ»ÑƒÑˆĞ°ĞµĞ¼ Ğ¢ĞĞ›Ğ¬ĞšĞ canvas â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ½ĞµĞ³Ğ¾ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸Ğ³Ñ€Ñ‹
CV.addEventListener('touchstart', onTap, {passive:false});
CV.addEventListener('mousedown',  onTap);
window.addEventListener('keydown', e=>{
  if(e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); onTap(null); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞšĞĞĞŸĞšĞ˜ GAME OVER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function clickAgain(){
  beginCountdown();
}
function clickMenu(){
  hideEl('gameover');
  initWorld();
  STATE = 'menu';
  showEl('menu');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ ĞĞ“Ğ Ğ•Ğ¡Ğ¡Ğ˜Ğ¯ Ğ¡Ğ›ĞĞ–ĞĞĞ¡Ğ¢Ğ˜
// ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¾Ñ‡ĞºĞ¾Ğ² â€” Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (Ğ¼Ğ°ĞºÑ 10)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getDifficulty(){
  // level 1..10
  const lvl = Math.min(20, 1 + Math.floor(score / 5));
  const t = (lvl-1)/19; // 0..1

  return {
    lvl,
    // Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: Ğ¾Ñ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ Ğ´Ğ¾ +90%
    spd:  SPEED * (1 + t * 0.9),
    // Ğ—Ğ°Ğ·Ğ¾Ñ€ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ñ€ÑƒĞ±Ğ°Ğ¼Ğ¸: Ğ¾Ñ‚ GAP Ğ´Ğ¾ GAP*0.52 (Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ²Ğ´Ğ²Ğ¾Ğµ ÑƒĞ¶Ğµ)
    gap:  GAP * (1 - t * 0.48),
    // Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ñ€ÑƒĞ±Ğ°Ğ¼Ğ¸: Ñ‡Ğ°Ñ‰Ğµ Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ
    interval: Math.round(PIPE_INT * (1 - t * 0.35)),
    // Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ° Ñ‚Ñ€ÑƒĞ±: Ñ‡ÑƒÑ‚ÑŒ Ñ‚Ğ¾Ğ»Ñ‰Ğµ
    pw: Math.max(60, Math.min(95, W*.09) * (1 + t * 0.25)),
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ˜Ğ“Ğ ĞĞ’ĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateGame(){
  bird.v += GRAV;
  bird.y += bird.v;
  bird.wing += .15;

  const diff = getDifficulty();

  // ĞŸĞ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞ¿Ñ‹ÑˆĞºÑƒ
  if(diff.lvl > level){
    level = diff.lvl;
    lastLevelScore = score;
    // Ğ¡Ğ²ĞµÑ‚Ğ¾Ğ²Ğ°Ñ Ğ²ÑĞ¿Ñ‹ÑˆĞºĞ°
    lightFlash = 6;
  }

  // Ğ¢Ñ€ÑƒĞ±Ñ‹ â€” Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ‡ĞµÑ€ĞµĞ· interval ĞºĞ°Ğ´Ñ€Ğ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°
  if(frame > 0 && frame % diff.interval === 0){
    const minH = H*.1;
    const maxH = H - diff.gap - H*.1;
    const th = minH + Math.random() * Math.max(0, maxH - minH);
    pipes.push({x:W+10, w:diff.pw, h:th,             top:true,  passed:false});
    pipes.push({x:W+10, w:diff.pw, h:H-th-diff.gap,  top:false});
  }

  if(comboTimer>0) comboTimer--;
  else if(combo>0){ combo=0; updateComboUI(); }

  const br = Math.min(W,H)/520*9;

  for(let i=pipes.length-1; i>=0; i--){
    const p = pipes[i];
    p.x -= diff.spd;

    const py = p.top ? 0 : H-p.h;
    if(bird.x+br > p.x && bird.x-br < p.x+p.w &&
       bird.y+br > py  && bird.y-br < py+p.h){
      triggerDeath(); return;
    }

    if(!p.passed && p.top && p.x+p.w < bird.x){
      p.passed=true; score++;
      combo++; comboTimer=110;
      document.getElementById('hud-score').textContent = score;
      updateComboUI();
      spawnPts();
      // Ğ¡Ğ¿Ğ¸Ğ´Ğ±Ğ°Ñ€ = Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (0..100%)
      const progressInLevel = ((score % 5) / 5) * 100;
      document.getElementById('speedbar-fill').style.width = progressInLevel+'%';
    }
    if(p.x < -p.w-10) pipes.splice(i,1);
  }

  if(bird.y > H+20 || bird.y < -20) triggerDeath();

  if(Math.random()<.0012 && lightFlash<=0) lightFlash=10+Math.floor(Math.random()*8);
  if(lightFlash>0) lightFlash--;

  frame++;
}

function updateComboUI(){
  const el = document.getElementById('hud-combo');
  if(combo>=3){ el.style.opacity='1'; el.textContent='Ã—'+combo+' ĞšĞĞœĞ‘Ğ!'; }
  else el.style.opacity='0';
}

function spawnPts(){
  const cols=['#f1c40f','#e67e22','#2ecc71','#fff'];
  for(let i=0;i<7;i++) particles.push({
    x:bird.x, y:bird.y,
    vx:(Math.random()-.5)*5, vy:-Math.random()*4-1,
    r:3+Math.random()*4, col:cols[i%4], life:1
  });
}

function updateIdle(){
  bird.y = H/2 + Math.sin(frame*.05)*16;
  bird.v = Math.cos(frame*.05)*.8;
  bird.wing += .09;
  frame++;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¡ĞœĞ•Ğ Ğ¢Ğ¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function triggerDeath(){
  if(STATE==='over') return;
  STATE = 'over';
  hideEl('hud');
  document.getElementById('speedbar').style.display='none';

  for(let i=0;i<24;i++) particles.push({
    x:bird.x, y:bird.y,
    vx:(Math.random()-.5)*11, vy:(Math.random()-.5)*11,
    r:4+Math.random()*8, col:['#e74c3c','#f1c40f','#fff'][i%3], life:1
  });

  const rec = saveScore(playerName, score, BIRDS[birdIdx].id);
  setTimeout(()=>showGameOver(rec), 800);
}

function showGameOver(rec){
  document.getElementById('go-score').textContent = score+' ĞĞ§ĞšĞĞ’';
  document.getElementById('go-best').textContent =
    rec.isNew ? 'ğŸ‰ ĞĞĞ’Ğ«Ğ™ Ğ Ğ•ĞšĞĞ Ğ”!' : ('Ğ¢Ğ²Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´: '+rec.best);
  renderLB('lb-rows');
  showEl('gameover');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ•Ğ™Ğ¢Ğ˜ĞĞ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LB_KEY = 'buria_orlov_v1';
function getLB(){ try{return JSON.parse(localStorage.getItem(LB_KEY)||'[]');}catch(e){return[];} }

function saveScore(name, s, birdId){
  let lb = getLB();
  const ei = lb.findIndex(e=>e.name.toLowerCase()===name.toLowerCase());
  let prev=0, isNew=false;
  if(ei>=0){ prev=lb[ei].s; if(s>prev){lb[ei]={name,s,birdId};isNew=true;} }
  else{ lb.push({name,s,birdId}); isNew=true; }
  lb.sort((a,b)=>b.s-a.s);
  lb=lb.slice(0,20);
  localStorage.setItem(LB_KEY, JSON.stringify(lb));
  return {best:Math.max(s,prev), isNew};
}

function renderLB(cid){
  const lb = getLB();
  const el = document.getElementById(cid);
  const ranks = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4.','5.','6.','7.','8.'];
  const me = playerName.toLowerCase();
  if(!lb.length){
    el.innerHTML='<div class="lb-row" style="opacity:.4;justify-content:center">ĞĞµÑ‚ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ğ¾Ğ²</div>';
    return;
  }
  el.innerHTML = lb.slice(0,6).map((e,i)=>{
    const isMe = e.name.toLowerCase()===me;
    const bd = BIRDS.find(b=>b.id===e.birdId)||BIRDS[0];
    return `<div class="lb-row${isMe?' lb-me':''}">
      <span class="lb-rank">${ranks[i]||i+1+'.'}</span>
      <span class="lb-icon">${bd.emoji}</span>
      <span class="lb-name${isMe?' me':''}">${esc(e.name)}</span>
      <span class="lb-pts">${e.s}</span>
    </div>`;
  }).join('');
}

function esc(s){
  return s.replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c]));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ˜Ğ¡ĞĞ’ĞĞĞ˜Ğ• Ğ¤ĞĞĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function lp3(a,b,t){ return a.map((v,i)=>Math.round(v+(b[i]-v)*Math.max(0,Math.min(1,t)))); }

function drawSky(){
  const N=[[8,6,22],[12,10,35]], D=[[60,20,60],[100,30,80]],
        Y=[[28,95,185],[95,172,245]], S=[[75,28,18],[170,75,28]];
  let top,bot; const c=cycleDayNight;
  if(c<.25){const t=c/.25;       top=lp3(N[0],D[0],t);bot=lp3(N[1],D[1],t);}
  else if(c<.5){const t=(c-.25)/.25; top=lp3(D[0],Y[0],t);bot=lp3(D[1],Y[1],t);}
  else if(c<.75){const t=(c-.5)/.25;  top=lp3(Y[0],S[0],t);bot=lp3(Y[1],S[1],t);}
  else{const t=(c-.75)/.25;           top=lp3(S[0],N[0],t);bot=lp3(S[1],N[1],t);}
  if(lightFlash>0){const f=lightFlash/12;top=lp3(top,[230,235,255],f*.8);bot=lp3(bot,[190,210,255],f*.6);}
  const g=CX.createLinearGradient(0,0,0,H);
  g.addColorStop(0,`rgb(${top})`); g.addColorStop(1,`rgb(${bot})`);
  CX.fillStyle=g; CX.fillRect(0,0,W,H);
}

function drawStars(){
  const al=cycleDayNight<.3?1:cycleDayNight<.5?1-(cycleDayNight-.3)/.2:0;
  if(al<=0) return;
  stars.forEach(s=>{
    s.tw+=.035;
    CX.globalAlpha=al*(.4+Math.sin(s.tw)*.6);
    CX.fillStyle='#fff';
    if(s.r>0){CX.beginPath(); CX.arc(s.x,s.y,s.r,0,Math.PI*2); CX.fill();}
  });
  CX.globalAlpha=1;
}

function drawCelestial(){
  const sx=W*.82, c=cycleDayNight;
  const sy=H*.13+Math.sin(c*Math.PI*2)*H*.08;
  if(c>.18&&c<.82){
    const op=c<.28?(c-.18)/.1:c>.72?1-(c-.72)/.1:1;
    CX.globalAlpha=op;
    const sg=CX.createRadialGradient(sx,sy,0,sx,sy,55);
    sg.addColorStop(0,'rgba(255,255,195,1)'); sg.addColorStop(.45,'rgba(255,215,45,.75)'); sg.addColorStop(1,'rgba(255,140,0,0)');
    CX.fillStyle=sg; CX.beginPath(); CX.arc(sx,sy,55,0,Math.PI*2); CX.fill();
    CX.globalAlpha=1;
  } else {
    const ma=c<.1?1-c/.1:c>.9?(c-.9)/.1:1;
    CX.globalAlpha=Math.max(0,ma);
    CX.fillStyle='#ddeeff'; CX.beginPath(); CX.arc(sx,sy,20,0,Math.PI*2); CX.fill();
    CX.fillStyle='rgba(140,170,210,.55)'; CX.beginPath(); CX.arc(sx+7,sy-4,16,0,Math.PI*2); CX.fill();
    CX.globalAlpha=1;
  }
}

function drawMountains(){
  const c=cycleDayNight;
  const cols=[
    c<.5?lp3([18,28,55],[75,55,75],c*2):lp3([75,55,75],[38,18,28],(c-.5)*2),
    c<.5?lp3([13,22,45],[55,38,55],c*2):lp3([55,38,55],[28,13,22],(c-.5)*2),
    c<.5?lp3([8,16,35],[38,22,38],c*2) :lp3([38,22,38],[18,8,14],(c-.5)*2),
  ];
  mountains.forEach((m,li)=>{
    const spd=m.sp*(SPEED/3)*.14;
    m.pts.forEach(p=>p.x-=spd);
    if(m.pts[0].x<-W/m.pts.length*2){
      const last=m.pts[m.pts.length-1];
      m.pts.shift();
      m.pts.push({x:last.x+W/10,y:H*(.52+li*.13)-Math.random()*H*(.18-li*.04)});
    }
    CX.fillStyle=`rgb(${cols[li]})`;
    CX.beginPath(); CX.moveTo(0,H);
    m.pts.forEach(p=>CX.lineTo(p.x,p.y));
    CX.lineTo(W,H); CX.closePath(); CX.fill();
    if(li===0){
      CX.fillStyle=`rgba(255,255,255,${.12+c*.08})`;
      m.pts.forEach((p,i)=>{
        if(i===0||i===m.pts.length-1)return;
        CX.beginPath(); CX.moveTo(p.x-14,p.y+16); CX.lineTo(p.x,p.y); CX.lineTo(p.x+14,p.y+16); CX.closePath(); CX.fill();
      });
    }
  });
}

function drawClouds(){
  clouds.forEach(cl=>{
    cl.x-=cl.sp*(SPEED/3);
    if(cl.x<-180){cl.x=W+130;cl.y=30+Math.random()*H*.35;}
    CX.globalAlpha=.06+cycleDayNight*.11; CX.fillStyle='#fff';
    var cr1=Math.max(0,46*cl.s),cr2=Math.max(0,32*cl.s);
    [-1,0,1].forEach(d=>{ CX.beginPath(); CX.arc(cl.x+d*38*cl.s,cl.y,cr1,0,Math.PI*2); CX.fill(); });
    CX.beginPath(); CX.arc(cl.x,cl.y-22*cl.s,cr2,0,Math.PI*2); CX.fill();
    CX.globalAlpha=1;
  });
}

function drawPipes(){
  const night=cycleDayNight<.25||cycleDayNight>.75;
  pipes.forEach(p=>{
    const py=p.top?0:H-p.h;
    const rg=CX.createLinearGradient(p.x,0,p.x+p.w,0);
    if(night){rg.addColorStop(0,'#0b1824');rg.addColorStop(.5,'#162433');rg.addColorStop(1,'#081018');}
    else{rg.addColorStop(0,'#18182a');rg.addColorStop(.5,'#282840');rg.addColorStop(1,'#101020');}
    CX.fillStyle=rg;
    rrect(CX,p.x,py,p.w,p.h,p.top?[0,0,10,10]:[10,10,0,0]); CX.fill();
    const nc=night?'#3498db':'#7c4dff';
    CX.strokeStyle=nc; CX.lineWidth=2; CX.shadowBlur=night?14:6; CX.shadowColor=nc;
    rrect(CX,p.x,py,p.w,p.h,p.top?[0,0,10,10]:[10,10,0,0]); CX.stroke();
    CX.shadowBlur=0;
    CX.fillStyle=nc; CX.globalAlpha=.65;
    if(p.top) CX.fillRect(p.x,p.h-5,p.w,5); else CX.fillRect(p.x,H-p.h,p.w,5);
    CX.globalAlpha=1;
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ˜Ğ¡ĞĞ’ĞĞĞ˜Ğ• ĞĞ¢Ğ¡Ğ§ĞĞ¢Ğ Ğ˜ "TAP" ĞĞ CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawOverlayCanvas(){
  const cx=W/2, cy=H/2;

  if(STATE==='countdown'){
    // ĞŸĞ¾Ğ»ÑƒĞ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½
    CX.fillStyle='rgba(0,0,0,.45)';
    CX.fillRect(0,0,W,H);
    // Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾
    const sz=Math.min(W,H)*.28;
    CX.font=`900 ${sz}px Arial, sans-serif`;
    CX.textAlign='center';
    CX.textBaseline='middle';
    // Ğ¢ĞµĞ½ÑŒ-ÑĞ²ĞµÑ‡ĞµĞ½Ğ¸Ğµ
    CX.shadowBlur=60; CX.shadowColor='rgba(241,196,15,.9)';
    CX.fillStyle='#f1c40f';
    CX.fillText(String(cdNum), cx, cy);
    CX.shadowBlur=0;
    // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¿Ñ‚Ğ¸Ñ†Ñ‹ ÑĞ½Ğ¸Ğ·Ñƒ
    const bdef=BIRDS[birdIdx];
    CX.font=`700 ${Math.min(W,H)*.04}px Arial, sans-serif`;
    CX.fillStyle='rgba(255,255,255,.55)';
    CX.fillText(bdef.emoji+' '+bdef.name, cx, cy+sz*.72);
    // ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚ Â«Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒÂ»
    CX.font=`400 ${Math.min(W,H)*.025}px Arial, sans-serif`;
    CX.fillStyle='rgba(255,255,255,.25)';
    CX.fillText('Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ', cx, cy+sz*.72+Math.min(W,H)*.055);
    CX.textAlign='left'; CX.textBaseline='alphabetic';
    return;
  }

  if(STATE==='ready'){
    // ĞœĞ¸Ğ³Ğ°ÑÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°
    tapBlink += .05;
    const alpha = .45+Math.sin(tapBlink)*0.55;
    const fontSize = Math.min(W,H)*.055;
    const text = 'ğŸ‘†  ĞĞĞ–ĞœĞ˜ Ğ§Ğ¢ĞĞ‘Ğ« Ğ›Ğ•Ğ¢Ğ•Ğ¢Ğ¬';
    CX.font=`700 ${fontSize}px Arial, sans-serif`;
    CX.textAlign='center';
    CX.textBaseline='middle';
    // ĞŸĞ»Ğ°ÑˆĞºĞ°
    const tw=CX.measureText(text).width;
    const ph=fontSize*1.5, pw2=tw+fontSize*1.2;
    const bx=cx-pw2/2, by=cy-ph/2;
    CX.fillStyle=`rgba(0,0,0,${alpha*.65})`;
    rrect(CX,bx,by,pw2,ph,ph/2); CX.fill();
    CX.strokeStyle=`rgba(255,255,255,${alpha*.4})`;
    CX.lineWidth=1.5;
    rrect(CX,bx,by,pw2,ph,ph/2); CX.stroke();
    CX.globalAlpha=alpha;
    CX.fillStyle='#fff';
    CX.shadowBlur=18; CX.shadowColor='rgba(255,255,255,.6)';
    CX.fillText(text, cx, cy);
    CX.shadowBlur=0; CX.globalAlpha=1;
    // Ğ˜Ğ¼Ñ Ğ¿Ñ‚Ğ¸Ñ†Ñ‹ Ğ¿Ğ¾Ğ´ Ğ½Ğ°Ğ´Ğ¿Ğ¸ÑÑŒÑ
    const bdef=BIRDS[birdIdx];
    CX.font=`600 ${fontSize*.55}px Arial, sans-serif`;
    CX.fillStyle='rgba(255,255,255,.4)';
    CX.fillText(bdef.emoji+' '+bdef.name, cx, cy+fontSize*1.3);
    CX.textAlign='left'; CX.textBaseline='alphabetic';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ˜Ğ¡ĞĞ’ĞĞĞ˜Ğ• ĞŸĞ¢Ğ˜Ğ¦Ğ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawBird(){
  const b=BIRDS[birdIdx];
  const sc=Math.min(W,H)/520;
  CX.save();
  CX.translate(bird.x,bird.y);
  const angle=Math.min(Math.PI/5,Math.max(-Math.PI/4,bird.v*.07));
  CX.rotate(angle);
  if(b.aura){CX.shadowBlur=18;CX.shadowColor=b.aura;}
  if(combo>=3){CX.shadowBlur=28;CX.shadowColor='#f1c40f';}
  CX.scale(sc,sc);
  const wf=Math.sin(bird.wing)*22;
  CX.fillStyle=b.wing;
  CX.beginPath(); CX.moveTo(-18,2); CX.quadraticCurveTo(0,-wf-24,18,2); CX.fill();
  CX.strokeStyle=b.body; CX.lineWidth=1; CX.globalAlpha=.4;
  for(let f=1;f<=3;f++){
    CX.beginPath(); CX.moveTo(-18+f*9,2);
    CX.quadraticCurveTo(-14+f*9,-wf*.5-f*3,-14+f*9,2); CX.stroke();
  }
  CX.globalAlpha=1;
  CX.fillStyle=b.body;
  CX.beginPath(); CX.ellipse(0,0,25,10,0,0,Math.PI*2); CX.fill();
  CX.fillStyle=b.head; CX.shadowBlur=0;
  CX.beginPath(); CX.arc(17,-4,10,0,Math.PI*2); CX.fill();
  CX.fillStyle=b.beak;
  CX.beginPath(); CX.moveTo(24,-4); CX.lineTo(36,-1); CX.lineTo(24,2); CX.fill();
  CX.fillStyle=b.eye;
  CX.beginPath(); CX.arc(20,-5,3,0,Math.PI*2); CX.fill();
  CX.fillStyle='#fff'; CX.beginPath(); CX.arc(21,-5.8,1.2,0,Math.PI*2); CX.fill();
  CX.fillStyle=b.wing;
  CX.beginPath(); CX.moveTo(-23,0); CX.lineTo(-35,-7); CX.lineTo(-27,3);  CX.fill();
  CX.beginPath(); CX.moveTo(-23,2); CX.lineTo(-33,10); CX.lineTo(-26,5);  CX.fill();
  CX.beginPath(); CX.moveTo(-23,1); CX.lineTo(-36,2);  CX.lineTo(-27,4);  CX.fill();
  if(b.id==='phoenix'){
    CX.globalAlpha=.7;
    ['#ff6b35','#f1c40f','#e74c3c'].forEach((col,ci)=>{
      CX.fillStyle=col;
      CX.beginPath();
      CX.moveTo(-23+ci*3,ci*2);
      CX.quadraticCurveTo(-30+ci*2,-9-Math.sin(frame*.14+ci)*7,-35+ci*3,-4+ci);
      CX.quadraticCurveTo(-28+ci,-2+Math.cos(frame*.14+ci)*4,-23+ci*3,ci*2);
      CX.fill();
    });
    CX.globalAlpha=1;
  }
  CX.restore();
  trails.push({x:bird.x-10,y:bird.y,r:5,life:1});
  if(trails.length>20) trails.shift();
  trails.forEach(t=>t.life-=.06);
  trails=trails.filter(t=>t.life>0);
  trails.forEach(t=>{
    CX.globalAlpha=t.life*.45; CX.fillStyle=b.trail;
    var tr=t.r*t.life; if(tr>0){CX.beginPath(); CX.arc(t.x,t.y,tr,0,Math.PI*2); CX.fill();}
  });
  CX.globalAlpha=1;
}

function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx; p.y+=p.vy; p.vy+=.08;
    p.life-=.03; p.r*=.96;
    if(p.life<=0){particles.splice(i,1);continue;}
    CX.globalAlpha=p.life; CX.fillStyle=p.col;
    if(p.r>0){CX.beginPath(); CX.arc(p.x,p.y,p.r,0,Math.PI*2); CX.fill();}
  }
  CX.globalAlpha=1;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ Ğ•Ğ”ĞŸĞ ĞĞ¡ĞœĞĞ¢Ğ  ĞŸĞ¢Ğ˜Ğ¦Ğ« Ğ’ ĞœĞ•ĞĞ®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSelector(){
  const grid=document.getElementById('sel-grid');
  grid.innerHTML='';
  BIRDS.forEach((b,i)=>{
    const div=document.createElement('div');
    div.className='sel-card'+(i===0?' active':'');
    const cv=document.createElement('canvas'); cv.width=54; cv.height=54;
    const nm=document.createElement('div'); nm.className='cname'; nm.textContent=b.name;
    const tg=document.createElement('div'); tg.className='ctag';  tg.textContent=b.tag;
    div.append(cv,nm,tg);
    div.onclick=()=>{
      document.querySelectorAll('.sel-card').forEach(c=>c.classList.remove('active'));
      div.classList.add('active');
      birdIdx=i;
    };
    grid.appendChild(div);
    drawPreview(b,cv);
  });
}

function drawPreview(b,cv){
  const c=cv.getContext('2d');
  c.save(); c.translate(27,27);
  c.fillStyle=b.wing; c.beginPath(); c.moveTo(-14,0); c.quadraticCurveTo(0,-20,14,0); c.fill();
  c.fillStyle=b.body; c.beginPath(); c.ellipse(0,0,20,8,0,0,Math.PI*2); c.fill();
  c.fillStyle=b.head; c.beginPath(); c.arc(16,-4,9,0,Math.PI*2); c.fill();
  c.fillStyle=b.beak; c.beginPath(); c.moveTo(22,-4); c.lineTo(32,-1); c.lineTo(22,2); c.fill();
  c.fillStyle=b.eye;  c.beginPath(); c.arc(19,-5,2.5,0,Math.PI*2); c.fill();
  c.fillStyle='#fff'; c.beginPath(); c.arc(20,-5.5,1,0,Math.PI*2); c.fill();
  c.fillStyle=b.wing;
  c.beginPath(); c.moveTo(-20,0); c.lineTo(-30,-5); c.lineTo(-24,2); c.fill();
  c.beginPath(); c.moveTo(-20,2); c.lineTo(-28,8);  c.lineTo(-23,4); c.fill();
  if(b.aura){
    c.shadowBlur=12; c.shadowColor=b.aura;
    c.strokeStyle=b.aura; c.lineWidth=1.5;
    c.beginPath(); c.ellipse(0,0,21,9,0,0,Math.PI*2); c.stroke();
    c.shadowBlur=0;
  }
  c.restore();
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ˜ LEVEL-UP ĞĞ CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawLevelHud(){
  if(STATE!=='playing' && STATE!=='over') return;

  const diff = getDifficulty();
  const fs = Math.min(W,H)*.028;

  // Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ â€” Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹ Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ ÑƒĞ³Ğ¾Ğ» (Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ¼Ğ±Ğ¾)
  CX.save();
  CX.textAlign='right';
  CX.textBaseline='top';
  CX.font='700 '+fs+'px Arial,sans-serif';

  // Ğ¦Ğ²ĞµÑ‚ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ: Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹â†’Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğ¹â†’ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹
  const t=(level-1)/9;
  const r=Math.round(80+t*175), g=Math.round(220-t*120), b=80;
  const col='rgb('+r+','+g+','+b+')';

  CX.fillStyle='rgba(0,0,0,.4)';
  CX.fillRect(W-fs*5.5, fs*.5, fs*5, fs*1.6);

  CX.fillStyle=col;
  CX.shadowBlur=8; CX.shadowColor=col;
  CX.fillText('Ğ£Ğ . '+level+' / 20', W-fs*.6, fs*.7);
  CX.shadowBlur=0;
  CX.restore();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ Ğ¦Ğ˜ĞšĞ›
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loop(){
  cycleDayNight=(cycleDayNight+.00035)%1;
  CX.clearRect(0,0,W,H);

  // Ğ¤Ğ¾Ğ½ Ñ€Ğ¸ÑÑƒĞµÑ‚ÑÑ Ğ²ÑĞµĞ³Ğ´Ğ° (ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾ Ğ·Ğ° Ğ¼ĞµĞ½Ñ Ñ‚Ğ¾Ğ¶Ğµ)
  drawSky();
  drawStars();
  drawCelestial();
  drawMountains();
  drawClouds();

  // Ğ¢Ñ€ÑƒĞ±Ñ‹ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¸Ğ³Ñ€Ğµ Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¼ĞµÑ€Ñ‚Ğ¸
  if(STATE==='playing'||STATE==='over') drawPipes();

  // ĞŸÑ‚Ğ¸Ñ†Ğ° + Ñ‡Ğ°ÑÑ‚Ğ¸Ñ†Ñ‹ â€” Ğ²ÑĞµĞ³Ğ´Ğ° ĞºÑ€Ğ¾Ğ¼Ğµ Ğ¼ĞµĞ½Ñ
  if(STATE!=='menu'){
    if(STATE==='countdown'||STATE==='ready') updateIdle();
    if(STATE==='playing') updateGame();
    drawBird();
    drawParticles();
    drawLevelHud();
    // ĞÑ‚ÑÑ‡Ñ‘Ñ‚/tap â€” Ñ€Ğ¸ÑÑƒĞµĞ¼ ĞĞ canvas Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ²ÑĞµĞ³Ğ¾
    drawOverlayCanvas();
  }

  requestAnimationFrame(loop);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ—ĞĞŸĞ£Ğ¡Ğš
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
resize();
buildSelector();
initWorld();
loop(); // â† Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ñ†Ğ¸ĞºĞ» ÑÑ€Ğ°Ğ·Ñƒ
</script>
</body>
</html>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Ğ‘ÑƒÑ€Ñ ĞÑ€Ğ»Ğ¾Ğ²</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{width:100%;height:100%;overflow:hidden;background:#000;touch-action:none;font-family:'Segoe UI',Arial,sans-serif}
canvas{display:block;position:fixed;top:0;left:0}

/* â”€â”€ ĞŸĞĞ’Ğ•Ğ ĞĞ£Ğ¢Ğ¬ Ğ­ĞšĞ ĞĞ â”€â”€ */
#rotate{display:none;position:fixed;inset:0;z-index:9999;background:#05080f;
  flex-direction:column;align-items:center;justify-content:center;gap:20px;text-align:center}
#rotate-icon{font-size:72px;animation:rtilt 1.5s ease-in-out infinite alternate}
@keyframes rtilt{from{transform:rotate(-30deg)}to{transform:rotate(30deg)}}
#rotate p{color:#f1c40f;font-size:20px;font-weight:700;letter-spacing:2px;padding:0 20px}

/* â”€â”€ ĞœĞ•ĞĞ® Ğ’Ğ«Ğ‘ĞĞ Ğ ĞŸĞ¢Ğ˜Ğ¦Ğ« â€” Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ²ÑĞµĞ³Ğ¾ â”€â”€ */
#menu{position:fixed;inset:0;z-index:500;background:rgba(3,6,18,.95);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0;padding:16px}

.sel-title{font-size:clamp(28px,6vw,48px);font-weight:900;letter-spacing:3px;
  background:linear-gradient(135deg,#f1c40f,#e67e22);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:4px;text-align:center}
.sel-sub{font-size:12px;letter-spacing:5px;color:rgba(255,255,255,.35);margin-bottom:16px;text-align:center}

.sel-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
  width:100%;max-width:680px;margin-bottom:16px}
.sel-card{background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.12);
  border-radius:14px;padding:10px 6px 8px;cursor:pointer;transition:.2s;text-align:center}
.sel-card:hover{border-color:rgba(241,196,15,.7);transform:translateY(-3px)}
.sel-card.active{border-color:#f1c40f;background:rgba(241,196,15,.1)}
.sel-card canvas{display:block;margin:0 auto 6px;width:54px;height:54px}
.sel-card .cname{font-size:11px;font-weight:700;letter-spacing:1px;color:rgba(255,255,255,.7)}
.sel-card.active .cname{color:#f1c40f}
.sel-card .ctag{font-size:9px;color:rgba(255,255,255,.3);margin-top:2px}

.sel-name-row{display:flex;gap:10px;align-items:center;margin-bottom:14px;width:100%;max-width:500px}
.sel-name-row input{flex:1;padding:12px 16px;border-radius:10px;
  border:2px solid rgba(241,196,15,.3);background:rgba(255,255,255,.07);
  color:#fff;font-size:16px;font-weight:700;outline:none;text-align:center;
  font-family:inherit;transition:.2s}
.sel-name-row input:focus{border-color:#f1c40f;box-shadow:0 0 14px rgba(241,196,15,.25)}
.sel-name-row input::placeholder{color:rgba(255,255,255,.3)}

.sel-btns{display:flex;gap:12px;width:100%;max-width:500px}
.btn-play{flex:2;padding:15px;border:none;border-radius:12px;
  background:linear-gradient(135deg,#f1c40f,#e67e22);
  color:#000;font-size:18px;font-weight:900;letter-spacing:2px;cursor:pointer;transition:.2s}
.btn-play:hover{transform:scale(1.03);box-shadow:0 0 24px rgba(241,196,15,.5)}
.btn-play:active{transform:scale(.97)}
.btn-anon{flex:1;padding:15px;border:1px solid rgba(255,255,255,.2);border-radius:12px;
  background:rgba(255,255,255,.07);color:rgba(255,255,255,.7);
  font-size:14px;font-weight:700;letter-spacing:1px;cursor:pointer;transition:.2s}
.btn-anon:hover{background:rgba(255,255,255,.14)}

/* â”€â”€ GAME OVER â€” Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ²ÑĞµĞ³Ğ¾ â”€â”€ */
#gameover{position:fixed;inset:0;z-index:500;display:none;
  background:rgba(3,6,18,.93);backdrop-filter:blur(12px);
  flex-direction:column;align-items:center;justify-content:center;gap:14px;padding:20px}
.go-title{font-size:clamp(36px,9vw,64px);font-weight:900;
  color:#e74c3c;text-shadow:0 0 30px rgba(231,76,60,.7)}
.go-score{font-size:clamp(24px,5vw,40px);font-weight:900;color:#f1c40f}
.go-best{font-size:13px;color:rgba(255,255,255,.4);letter-spacing:2px}
.go-lb{width:100%;max-width:440px;background:rgba(0,0,0,.4);
  border:1px solid rgba(255,255,255,.1);border-radius:12px;overflow:hidden}
.go-lb-head{padding:8px 14px;background:rgba(241,196,15,.08);
  font-size:11px;letter-spacing:4px;color:#f1c40f;font-weight:700;
  border-bottom:1px solid rgba(241,196,15,.12)}
.lb-row{display:flex;align-items:center;gap:8px;padding:7px 14px;
  border-bottom:1px solid rgba(255,255,255,.04);font-size:13px;font-weight:600}
.lb-row:last-child{border-bottom:none}
.lb-me{background:rgba(241,196,15,.07)}
.lb-rank{width:22px;font-size:15px;text-align:center}
.lb-icon{font-size:16px}
.lb-name{flex:1;color:rgba(255,255,255,.8)}
.lb-name.me{color:#f1c40f}
.lb-pts{color:#f1c40f;font-weight:900;font-size:15px}
.go-btns{display:flex;gap:12px}
.btn-again{padding:14px 32px;border:none;border-radius:12px;
  background:linear-gradient(135deg,#2ecc71,#16a085);
  color:#fff;font-size:16px;font-weight:900;letter-spacing:2px;cursor:pointer;transition:.2s}
.btn-again:hover{transform:scale(1.04)}
.btn-again:active{transform:scale(.96)}
.btn-back{padding:14px 24px;border:1px solid rgba(255,255,255,.2);border-radius:12px;
  background:rgba(255,255,255,.08);color:#fff;font-size:16px;font-weight:700;
  letter-spacing:1px;cursor:pointer;transition:.2s}
.btn-back:hover{background:rgba(255,255,255,.15)}
.btn-back:active{transform:scale(.96)}

/* â”€â”€ HUD â”€â”€ */
#hud{position:fixed;top:0;left:0;right:0;z-index:100;pointer-events:none;
  display:none;align-items:flex-start;justify-content:space-between;padding:10px 18px}
#hud-score{font-size:clamp(30px,6vw,52px);font-weight:900;
  color:#f1c40f;text-shadow:0 0 18px rgba(241,196,15,.8),0 2px 4px #000;line-height:1}
#hud-label{font-size:10px;letter-spacing:3px;color:rgba(255,255,255,.4);margin-top:2px}
#hud-combo{font-size:clamp(14px,2.5vw,22px);color:#e74c3c;font-weight:900;
  text-shadow:0 0 12px rgba(231,76,60,.9);opacity:0;transition:opacity .3s;text-align:right}
#speedbar{position:fixed;bottom:0;left:0;right:0;height:4px;z-index:100;
  background:rgba(255,255,255,.1);display:none}
#speedbar-fill{height:100%;width:0%;background:linear-gradient(90deg,#2ecc71,#f1c40f,#e74c3c);transition:width .5s}

@media(max-width:600px){
  .sel-grid{gap:7px}
  .sel-card canvas{width:44px;height:44px}
  .sel-btns{flex-direction:column}
  .go-btns{flex-direction:column;width:100%;max-width:300px}
  .btn-again,.btn-back{width:100%}
}
@media(max-height:400px){
  .sel-card{padding:6px 4px 4px}
  .sel-card canvas{width:38px;height:38px}
  .sel-sub{margin-bottom:8px}
  .sel-name-row{margin-bottom:8px}
}
</style>
</head>
<body>

<div id="rotate">
  <div id="rotate-icon">ğŸ“±</div>
  <p>ĞŸĞĞ’Ğ•Ğ ĞĞ˜ Ğ¢Ğ•Ğ›Ğ•Ğ¤ĞĞ<br>Ğ“ĞĞ Ğ˜Ğ—ĞĞĞ¢ĞĞ›Ğ¬ĞĞ</p>
</div>

<!-- Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ CANVAS â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ…Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸Ğ³Ñ€Ñ‹ -->
<canvas id="c"></canvas>

<!-- ĞœĞ•ĞĞ® Ğ’Ğ«Ğ‘ĞĞ Ğ ĞŸĞ¢Ğ˜Ğ¦Ğ« -->
<div id="menu">
  <div class="sel-title">ğŸ¦… Ğ‘Ğ£Ğ Ğ¯ ĞĞ Ğ›ĞĞ’</div>
  <div class="sel-sub">Ğ’Ğ«Ğ‘Ğ•Ğ Ğ˜ ĞŸĞ¢Ğ˜Ğ¦Ğ£ â€” Ğ›Ğ•Ğ¢Ğ˜ â€” ĞŸĞĞ‘Ğ•Ğ–Ğ”ĞĞ™</div>
  <div class="sel-grid" id="sel-grid"></div>
  <div class="sel-name-row">
    <input type="text" id="inp-name" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸ Ğ¸Ğ¼Ñ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)"
           maxlength="12" autocomplete="off" autocorrect="off" spellcheck="false">
  </div>
  <div class="sel-btns">
    <button class="btn-play" onclick="clickPlay()">â–¶ Ğ˜Ğ“Ğ ĞĞ¢Ğ¬</button>
    <button class="btn-anon" onclick="clickAnon()">Ğ‘ĞµĞ· Ğ¸Ğ¼ĞµĞ½Ğ¸</button>
  </div>
</div>

<!-- GAME OVER -->
<div id="gameover">
  <div class="go-title">ğŸ’¥ ĞšĞ Ğ£Ğ¨Ğ•ĞĞ˜Ğ•!</div>
  <div class="go-score" id="go-score">0 ĞĞ§ĞšĞĞ’</div>
  <div class="go-best"  id="go-best"></div>
  <div class="go-lb">
    <div class="go-lb-head">ğŸ† Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦Ğ Ğ Ğ•ĞšĞĞ Ğ”ĞĞ’</div>
    <div id="lb-rows"></div>
  </div>
  <div class="go-btns">
    <button class="btn-again" onclick="clickAgain()">â†» Ğ•Ğ©Ğ Ğ ĞĞ—</button>
    <button class="btn-back"  onclick="clickMenu()">âŒ‚ ĞœĞ•ĞĞ®</button>
  </div>
</div>

<!-- HUD -->
<div id="hud">
  <div>
    <div id="hud-score">0</div>
    <div id="hud-label">ĞĞ§ĞšĞ˜</div>
  </div>
  <div id="hud-combo"></div>
</div>
<div id="speedbar"><div id="speedbar-fill"></div></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ¢Ğ˜Ğ¦Ğ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BIRDS=[
  {id:'eagle',  name:'ĞĞ ĞĞ›',      tag:'ĞšĞ›ĞĞ¡Ğ¡Ğ˜ĞšĞ', emoji:'ğŸ¦…',body:'#5d4037',wing:'#3e2723',head:'#fff8e1',beak:'#f59e0b',eye:'#111',  aura:null,       trail:'rgba(139,90,43,.4)'},
  {id:'phoenix',name:'Ğ¤Ğ•ĞĞ˜ĞšĞ¡',    tag:'ĞĞ“ĞĞĞ¬',    emoji:'ğŸ”¥',body:'#e74c3c',wing:'#922b21',head:'#f39c12',beak:'#e67e22',eye:'#fff',  aura:'#ff6b35',  trail:'rgba(231,76,60,.5)'},
  {id:'raven',  name:'Ğ’ĞĞ ĞĞ',     tag:'Ğ¢Ğ•ĞĞ¬',     emoji:'ğŸ¦',body:'#1a1a2e',wing:'#0d0d1a',head:'#2c2c54',beak:'#95a5a6',eye:'#6c5ce7',aura:'#6c5ce7', trail:'rgba(108,92,231,.4)'},
  {id:'falcon', name:'Ğ¡ĞĞšĞĞ›',     tag:'Ğ¡ĞšĞĞ ĞĞ¡Ğ¢Ğ¬', emoji:'ğŸ¦…',body:'#2c3e50',wing:'#1a252f',head:'#ecf0f1',beak:'#e67e22',eye:'#e74c3c',aura:'#3498db', trail:'rgba(52,73,94,.4)'},
  {id:'parrot', name:'ĞŸĞĞŸĞ£Ğ“ĞĞ™',   tag:'Ğ£Ğ”ĞĞ§Ğ',    emoji:'ğŸ¦œ',body:'#27ae60',wing:'#1e8449',head:'#f1c40f',beak:'#e74c3c',eye:'#fff',  aura:'#f1c40f',  trail:'rgba(39,174,96,.4)'},
  {id:'storm',  name:'Ğ‘Ğ£Ğ Ğ•Ğ’Ğ•Ğ¡Ğ¢.', tag:'Ğ›Ğ•Ğ“Ğ•ĞĞ”Ğ',  emoji:'âš¡',body:'#7f8c8d',wing:'#636e72',head:'#dfe6e9',beak:'#fdcb6e',eye:'#6c5ce7',aura:'#fdcb6e', trail:'rgba(127,140,141,.5)'},
  {id:'ice',    name:'Ğ›Ğ•Ğ”Ğ¯ĞĞĞ™',   tag:'ĞĞ ĞšĞ¢Ğ˜ĞšĞ',  emoji:'â„ï¸',body:'#74b9ff',wing:'#0984e3',head:'#dfe6e9',beak:'#b2bec3',eye:'#111',  aura:'#74b9ff',  trail:'rgba(116,185,255,.5)'},
  {id:'golden', name:'Ğ—ĞĞ›ĞĞ¢ĞĞ™',   tag:'Ğ Ğ•Ğ”ĞšĞ˜Ğ™',   emoji:'âœ¨',body:'#f1c40f',wing:'#e67e22',head:'#fffde7',beak:'#e67e22',eye:'#2d3436',aura:'#f1c40f', trail:'rgba(241,196,15,.6)'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CV = document.getElementById('c');
const CX = CV.getContext('2d');

// rrect â€” Ğ·Ğ°Ğ¼ĞµĞ½Ğ° roundRect (Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¾Ğ²)
// r Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ¼ [tl,tr,br,bl]
function rrect(ctx,x,y,w,h,r){
  var tl,tr,br,bl;
  if(Array.isArray(r)){
    tl=r[0]||0; tr=r[1]||0; br=r[2]||0; bl=r[3]||0;
  } else {
    tl=tr=br=bl=r||0;
  }
  ctx.beginPath();
  ctx.moveTo(x+tl,y);
  ctx.lineTo(x+w-tr,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+tr);
  ctx.lineTo(x+w,y+h-br);
  ctx.quadraticCurveTo(x+w,y+h,x+w-br,y+h);
  ctx.lineTo(x+bl,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-bl);
  ctx.lineTo(x,y+tl);
  ctx.quadraticCurveTo(x,y,x+tl,y);
  ctx.closePath();
}


let W=0, H=0;

function resize(){
  W = CV.width  = window.innerWidth;
  H = CV.height = window.innerHeight;
  recalcPhysics();
  checkRotate();
}
window.addEventListener('resize', resize);
window.addEventListener('orientationchange', ()=>setTimeout(resize,250));

function checkRotate(){
  const mob = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  document.getElementById('rotate').style.display =
    (mob && window.innerHeight > window.innerWidth) ? 'flex' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¤Ğ˜Ğ—Ğ˜ĞšĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let GRAV, JUMP, SPEED, GAP, PIPE_INT;
function recalcPhysics(){
  const sc = Math.min(W, H*16/9) / 800;
  GRAV     = 0.20 * sc;
  JUMP     = -5.5 * sc;
  SPEED    = 3.0  * sc;
  GAP      = Math.max(150, 230*(H/450));
  PIPE_INT = Math.round(110/sc);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ•
// STATE: 'menu' | 'countdown' | 'ready' | 'playing' | 'over'
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let STATE = 'menu';
let birdIdx = 0;
let playerName = 'Ğ˜Ğ“Ğ ĞĞš';

let bird, pipes, trails, particles;
let score, frame, combo, comboTimer;
let cycleDayNight = 0.55, lightFlash = 0;
let stars, clouds, mountains;

// ĞÑ‚ÑÑ‡Ñ‘Ñ‚ â€” Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² ÑÑ‚Ğ¸Ñ… Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…
let cdNum = 0;       // Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ñ‡Ğ¸ÑĞ»Ğ¾ 3/2/1
let cdTimer = null;  // handle setTimeout

// ĞœĞ¸Ğ³Ğ°Ğ½Ğ¸Ğµ "tap to fly"
let tapBlink = 0;

// Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸
let level = 1;
let lastLevelScore = 0; // ÑÑ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¼ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ ĞœĞ˜Ğ Ğ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initWorld(){
  recalcPhysics();
  bird = {x:W*0.22, y:H/2, v:0, wing:0};
  pipes=[];trails=[];particles=[];
  score=0; frame=0; combo=0; comboTimer=0; level=1; lastLevelScore=0;
  lightFlash=0; tapBlink=0;

  document.getElementById('hud-score').textContent = '0';
  document.getElementById('hud-combo').style.opacity = '0';
  document.getElementById('speedbar-fill').style.width = '0%';

  stars = Array.from({length:90},()=>({
    x:Math.random()*W, y:Math.random()*H*.65,
    r:.5+Math.random()*1.8, tw:Math.random()*Math.PI*2
  }));
  clouds = Array.from({length:7},()=>({
    x:Math.random()*W, y:30+Math.random()*H*.38,
    s:.5+Math.random()*.9, sp:.25+Math.random()*.35
  }));
  mountains = [0,1,2].map(li=>{
    const cnt=10+li*4;
    return {sp:(li+1)*.35, li,
      pts:Array.from({length:cnt+1},(_,i)=>({
        x:(W/cnt)*i,
        y:H*(.52+li*.13)-Math.random()*H*(.18-li*.04)
      }))
    };
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ’Ğ¡ĞŸĞĞœĞĞ“ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ• DOM-Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showEl(id){ document.getElementById(id).style.display='flex'; }
function hideEl(id){ document.getElementById(id).style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞšĞĞĞŸĞšĞ˜ ĞœĞ•ĞĞ®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function clickPlay(){
  const nm = document.getElementById('inp-name').value.trim();
  playerName = nm || 'Ğ˜Ğ“Ğ ĞĞš';
  beginCountdown();
}
function clickAnon(){
  playerName = 'Ğ˜Ğ“Ğ ĞĞš';
  beginCountdown();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞĞ¢Ğ¡Ğ§ĞĞ¢ 3-2-1 (Ñ€Ğ¸ÑÑƒĞµÑ‚ÑÑ ĞĞ CANVAS, Ğ½Ğµ HTML)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function beginCountdown(){
  if(cdTimer) clearTimeout(cdTimer);
  hideEl('menu');
  hideEl('gameover');
  hideEl('hud');
  document.getElementById('speedbar').style.display = 'none';
  initWorld();
  cdNum = 3;
  STATE = 'countdown';
  scheduleNextTick();
}

function scheduleNextTick(){
  cdTimer = setTimeout(cdTick, 1000);
}

function cdTick(){
  cdNum--;
  if(cdNum > 0){
    scheduleNextTick();
  } else {
    // ĞÑ‚ÑÑ‡Ñ‘Ñ‚ ĞºĞ¾Ğ½Ñ‡Ğ¸Ğ»ÑÑ â†’ STATE = ready
    cdTimer = null;
    STATE = 'ready';
    tapBlink = 0;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ•
// Ğ¢Ğ°Ğ¿Ñ‹/ĞºĞ»Ğ¸ĞºĞ¸/Ğ¿Ñ€Ğ¾Ğ±ĞµĞ» â€” Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½Ğ° canvas
// ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… HTML-Ğ¾Ğ²ĞµÑ€Ğ»ĞµĞµĞ² Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼ Ğ¸ canvas Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ countdown/ready/playing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onTap(e){
  if(e) e.preventDefault();

  if(STATE === 'countdown'){
    // ĞĞ°Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ÑÑ‡Ñ‘Ñ‚Ğ° â€” ÑƒÑĞºĞ¾Ñ€ÑĞµĞ¼, Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ ÑÑ€Ğ°Ğ·Ñƒ Ğ² ready
    if(cdTimer){ clearTimeout(cdTimer); cdTimer=null; }
    STATE = 'ready';
    tapBlink = 0;
    return;
  }

  if(STATE === 'ready'){
    // ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ñ‚Ğ°Ğ¿ â€” ÑÑ‚Ğ°Ñ€Ñ‚ Ğ¸Ğ³Ñ€Ñ‹
    STATE = 'playing';
    frame = 0;
    showEl('hud');
    document.getElementById('speedbar').style.display = 'block';
    doFlap();
    return;
  }

  if(STATE === 'playing'){
    doFlap();
  }
}

function doFlap(){
  bird.v = JUMP;
  const b = BIRDS[birdIdx];
  for(let i=0;i<5;i++) particles.push({
    x:bird.x-12, y:bird.y+4,
    vx:-Math.random()*2.5, vy:(Math.random()-.5)*3,
    r:2+Math.random()*2, col:b.trail, life:1
  });
}

// Ğ¡Ğ»ÑƒÑˆĞ°ĞµĞ¼ Ğ¢ĞĞ›Ğ¬ĞšĞ canvas â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ½ĞµĞ³Ğ¾ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸Ğ³Ñ€Ñ‹
CV.addEventListener('touchstart', onTap, {passive:false});
CV.addEventListener('mousedown',  onTap);
window.addEventListener('keydown', e=>{
  if(e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); onTap(null); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞšĞĞĞŸĞšĞ˜ GAME OVER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function clickAgain(){
  beginCountdown();
}
function clickMenu(){
  hideEl('gameover');
  initWorld();
  STATE = 'menu';
  showEl('menu');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ ĞĞ“Ğ Ğ•Ğ¡Ğ¡Ğ˜Ğ¯ Ğ¡Ğ›ĞĞ–ĞĞĞ¡Ğ¢Ğ˜
// ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¾Ñ‡ĞºĞ¾Ğ² â€” Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (Ğ¼Ğ°ĞºÑ 10)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getDifficulty(){
  // level 1..10
  const lvl = Math.min(20, 1 + Math.floor(score / 5));
  const t = (lvl-1)/19; // 0..1

  return {
    lvl,
    // Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: Ğ¾Ñ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ Ğ´Ğ¾ +90%
    spd:  SPEED * (1 + t * 0.9),
    // Ğ—Ğ°Ğ·Ğ¾Ñ€ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ñ€ÑƒĞ±Ğ°Ğ¼Ğ¸: Ğ¾Ñ‚ GAP Ğ´Ğ¾ GAP*0.52 (Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ²Ğ´Ğ²Ğ¾Ğµ ÑƒĞ¶Ğµ)
    gap:  GAP * (1 - t * 0.48),
    // Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ñ€ÑƒĞ±Ğ°Ğ¼Ğ¸: Ñ‡Ğ°Ñ‰Ğµ Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ
    interval: Math.round(PIPE_INT * (1 - t * 0.35)),
    // Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ° Ñ‚Ñ€ÑƒĞ±: Ñ‡ÑƒÑ‚ÑŒ Ñ‚Ğ¾Ğ»Ñ‰Ğµ
    pw: Math.max(60, Math.min(95, W*.09) * (1 + t * 0.25)),
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ˜Ğ“Ğ ĞĞ’ĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateGame(){
  bird.v += GRAV;
  bird.y += bird.v;
  bird.wing += .15;

  const diff = getDifficulty();

  // ĞŸĞ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞ¿Ñ‹ÑˆĞºÑƒ
  if(diff.lvl > level){
    level = diff.lvl;
    lastLevelScore = score;
    // Ğ¡Ğ²ĞµÑ‚Ğ¾Ğ²Ğ°Ñ Ğ²ÑĞ¿Ñ‹ÑˆĞºĞ°
    lightFlash = 6;
  }

  // Ğ¢Ñ€ÑƒĞ±Ñ‹ â€” Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ‡ĞµÑ€ĞµĞ· interval ĞºĞ°Ğ´Ñ€Ğ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°
  if(frame > 0 && frame % diff.interval === 0){
    const minH = H*.1;
    const maxH = H - diff.gap - H*.1;
    const th = minH + Math.random() * Math.max(0, maxH - minH);
    pipes.push({x:W+10, w:diff.pw, h:th,             top:true,  passed:false});
    pipes.push({x:W+10, w:diff.pw, h:H-th-diff.gap,  top:false});
  }

  if(comboTimer>0) comboTimer--;
  else if(combo>0){ combo=0; updateComboUI(); }

  const br = Math.min(W,H)/520*9;

  for(let i=pipes.length-1; i>=0; i--){
    const p = pipes[i];
    p.x -= diff.spd;

    const py = p.top ? 0 : H-p.h;
    if(bird.x+br > p.x && bird.x-br < p.x+p.w &&
       bird.y+br > py  && bird.y-br < py+p.h){
      triggerDeath(); return;
    }

    if(!p.passed && p.top && p.x+p.w < bird.x){
      p.passed=true; score++;
      combo++; comboTimer=110;
      document.getElementById('hud-score').textContent = score;
      updateComboUI();
      spawnPts();
      // Ğ¡Ğ¿Ğ¸Ğ´Ğ±Ğ°Ñ€ = Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (0..100%)
      const progressInLevel = ((score % 5) / 5) * 100;
      document.getElementById('speedbar-fill').style.width = progressInLevel+'%';
    }
    if(p.x < -p.w-10) pipes.splice(i,1);
  }

  if(bird.y > H+20 || bird.y < -20) triggerDeath();

  if(Math.random()<.0012 && lightFlash<=0) lightFlash=10+Math.floor(Math.random()*8);
  if(lightFlash>0) lightFlash--;

  frame++;
}

function updateComboUI(){
  const el = document.getElementById('hud-combo');
  if(combo>=3){ el.style.opacity='1'; el.textContent='Ã—'+combo+' ĞšĞĞœĞ‘Ğ!'; }
  else el.style.opacity='0';
}

function spawnPts(){
  const cols=['#f1c40f','#e67e22','#2ecc71','#fff'];
  for(let i=0;i<7;i++) particles.push({
    x:bird.x, y:bird.y,
    vx:(Math.random()-.5)*5, vy:-Math.random()*4-1,
    r:3+Math.random()*4, col:cols[i%4], life:1
  });
}

function updateIdle(){
  bird.y = H/2 + Math.sin(frame*.05)*16;
  bird.v = Math.cos(frame*.05)*.8;
  bird.wing += .09;
  frame++;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ¡ĞœĞ•Ğ Ğ¢Ğ¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function triggerDeath(){
  if(STATE==='over') return;
  STATE = 'over';
  hideEl('hud');
  document.getElementById('speedbar').style.display='none';

  for(let i=0;i<24;i++) particles.push({
    x:bird.x, y:bird.y,
    vx:(Math.random()-.5)*11, vy:(Math.random()-.5)*11,
    r:4+Math.random()*8, col:['#e74c3c','#f1c40f','#fff'][i%3], life:1
  });

  const rec = saveScore(playerName, score, BIRDS[birdIdx].id);
  setTimeout(()=>showGameOver(rec), 800);
}

function showGameOver(rec){
  document.getElementById('go-score').textContent = score+' ĞĞ§ĞšĞĞ’';
  document.getElementById('go-best').textContent =
    rec.isNew ? 'ğŸ‰ ĞĞĞ’Ğ«Ğ™ Ğ Ğ•ĞšĞĞ Ğ”!' : ('Ğ¢Ğ²Ğ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´: '+rec.best);
  renderLB('lb-rows');
  showEl('gameover');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ•Ğ™Ğ¢Ğ˜ĞĞ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LB_KEY = 'buria_orlov_v1';
function getLB(){ try{return JSON.parse(localStorage.getItem(LB_KEY)||'[]');}catch(e){return[];} }

function saveScore(name, s, birdId){
  let lb = getLB();
  const ei = lb.findIndex(e=>e.name.toLowerCase()===name.toLowerCase());
  let prev=0, isNew=false;
  if(ei>=0){ prev=lb[ei].s; if(s>prev){lb[ei]={name,s,birdId};isNew=true;} }
  else{ lb.push({name,s,birdId}); isNew=true; }
  lb.sort((a,b)=>b.s-a.s);
  lb=lb.slice(0,20);
  localStorage.setItem(LB_KEY, JSON.stringify(lb));
  return {best:Math.max(s,prev), isNew};
}

function renderLB(cid){
  const lb = getLB();
  const el = document.getElementById(cid);
  const ranks = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4.','5.','6.','7.','8.'];
  const me = playerName.toLowerCase();
  if(!lb.length){
    el.innerHTML='<div class="lb-row" style="opacity:.4;justify-content:center">ĞĞµÑ‚ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ğ¾Ğ²</div>';
    return;
  }
  el.innerHTML = lb.slice(0,6).map((e,i)=>{
    const isMe = e.name.toLowerCase()===me;
    const bd = BIRDS.find(b=>b.id===e.birdId)||BIRDS[0];
    return `<div class="lb-row${isMe?' lb-me':''}">
      <span class="lb-rank">${ranks[i]||i+1+'.'}</span>
      <span class="lb-icon">${bd.emoji}</span>
      <span class="lb-name${isMe?' me':''}">${esc(e.name)}</span>
      <span class="lb-pts">${e.s}</span>
    </div>`;
  }).join('');
}

function esc(s){
  return s.replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c]));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ˜Ğ¡ĞĞ’ĞĞĞ˜Ğ• Ğ¤ĞĞĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function lp3(a,b,t){ return a.map((v,i)=>Math.round(v+(b[i]-v)*Math.max(0,Math.min(1,t)))); }

function drawSky(){
  const N=[[8,6,22],[12,10,35]], D=[[60,20,60],[100,30,80]],
        Y=[[28,95,185],[95,172,245]], S=[[75,28,18],[170,75,28]];
  let top,bot; const c=cycleDayNight;
  if(c<.25){const t=c/.25;       top=lp3(N[0],D[0],t);bot=lp3(N[1],D[1],t);}
  else if(c<.5){const t=(c-.25)/.25; top=lp3(D[0],Y[0],t);bot=lp3(D[1],Y[1],t);}
  else if(c<.75){const t=(c-.5)/.25;  top=lp3(Y[0],S[0],t);bot=lp3(Y[1],S[1],t);}
  else{const t=(c-.75)/.25;           top=lp3(S[0],N[0],t);bot=lp3(S[1],N[1],t);}
  if(lightFlash>0){const f=lightFlash/12;top=lp3(top,[230,235,255],f*.8);bot=lp3(bot,[190,210,255],f*.6);}
  const g=CX.createLinearGradient(0,0,0,H);
  g.addColorStop(0,`rgb(${top})`); g.addColorStop(1,`rgb(${bot})`);
  CX.fillStyle=g; CX.fillRect(0,0,W,H);
}

function drawStars(){
  const al=cycleDayNight<.3?1:cycleDayNight<.5?1-(cycleDayNight-.3)/.2:0;
  if(al<=0) return;
  stars.forEach(s=>{
    s.tw+=.035;
    CX.globalAlpha=al*(.4+Math.sin(s.tw)*.6);
    CX.fillStyle='#fff';
    if(s.r>0){CX.beginPath(); CX.arc(s.x,s.y,s.r,0,Math.PI*2); CX.fill();}
  });
  CX.globalAlpha=1;
}

function drawCelestial(){
  const sx=W*.82, c=cycleDayNight;
  const sy=H*.13+Math.sin(c*Math.PI*2)*H*.08;
  if(c>.18&&c<.82){
    const op=c<.28?(c-.18)/.1:c>.72?1-(c-.72)/.1:1;
    CX.globalAlpha=op;
    const sg=CX.createRadialGradient(sx,sy,0,sx,sy,55);
    sg.addColorStop(0,'rgba(255,255,195,1)'); sg.addColorStop(.45,'rgba(255,215,45,.75)'); sg.addColorStop(1,'rgba(255,140,0,0)');
    CX.fillStyle=sg; CX.beginPath(); CX.arc(sx,sy,55,0,Math.PI*2); CX.fill();
    CX.globalAlpha=1;
  } else {
    const ma=c<.1?1-c/.1:c>.9?(c-.9)/.1:1;
    CX.globalAlpha=Math.max(0,ma);
    CX.fillStyle='#ddeeff'; CX.beginPath(); CX.arc(sx,sy,20,0,Math.PI*2); CX.fill();
    CX.fillStyle='rgba(140,170,210,.55)'; CX.beginPath(); CX.arc(sx+7,sy-4,16,0,Math.PI*2); CX.fill();
    CX.globalAlpha=1;
  }
}

function drawMountains(){
  const c=cycleDayNight;
  const cols=[
    c<.5?lp3([18,28,55],[75,55,75],c*2):lp3([75,55,75],[38,18,28],(c-.5)*2),
    c<.5?lp3([13,22,45],[55,38,55],c*2):lp3([55,38,55],[28,13,22],(c-.5)*2),
    c<.5?lp3([8,16,35],[38,22,38],c*2) :lp3([38,22,38],[18,8,14],(c-.5)*2),
  ];
  mountains.forEach((m,li)=>{
    const spd=m.sp*(SPEED/3)*.14;
    m.pts.forEach(p=>p.x-=spd);
    if(m.pts[0].x<-W/m.pts.length*2){
      const last=m.pts[m.pts.length-1];
      m.pts.shift();
      m.pts.push({x:last.x+W/10,y:H*(.52+li*.13)-Math.random()*H*(.18-li*.04)});
    }
    CX.fillStyle=`rgb(${cols[li]})`;
    CX.beginPath(); CX.moveTo(0,H);
    m.pts.forEach(p=>CX.lineTo(p.x,p.y));
    CX.lineTo(W,H); CX.closePath(); CX.fill();
    if(li===0){
      CX.fillStyle=`rgba(255,255,255,${.12+c*.08})`;
      m.pts.forEach((p,i)=>{
        if(i===0||i===m.pts.length-1)return;
        CX.beginPath(); CX.moveTo(p.x-14,p.y+16); CX.lineTo(p.x,p.y); CX.lineTo(p.x+14,p.y+16); CX.closePath(); CX.fill();
      });
    }
  });
}

function drawClouds(){
  clouds.forEach(cl=>{
    cl.x-=cl.sp*(SPEED/3);
    if(cl.x<-180){cl.x=W+130;cl.y=30+Math.random()*H*.35;}
    CX.globalAlpha=.06+cycleDayNight*.11; CX.fillStyle='#fff';
    var cr1=Math.max(0,46*cl.s),cr2=Math.max(0,32*cl.s);
    [-1,0,1].forEach(d=>{ CX.beginPath(); CX.arc(cl.x+d*38*cl.s,cl.y,cr1,0,Math.PI*2); CX.fill(); });
    CX.beginPath(); CX.arc(cl.x,cl.y-22*cl.s,cr2,0,Math.PI*2); CX.fill();
    CX.globalAlpha=1;
  });
}

function drawPipes(){
  const night=cycleDayNight<.25||cycleDayNight>.75;
  pipes.forEach(p=>{
    const py=p.top?0:H-p.h;
    const rg=CX.createLinearGradient(p.x,0,p.x+p.w,0);
    if(night){rg.addColorStop(0,'#0b1824');rg.addColorStop(.5,'#162433');rg.addColorStop(1,'#081018');}
    else{rg.addColorStop(0,'#18182a');rg.addColorStop(.5,'#282840');rg.addColorStop(1,'#101020');}
    CX.fillStyle=rg;
    rrect(CX,p.x,py,p.w,p.h,p.top?[0,0,10,10]:[10,10,0,0]); CX.fill();
    const nc=night?'#3498db':'#7c4dff';
    CX.strokeStyle=nc; CX.lineWidth=2; CX.shadowBlur=night?14:6; CX.shadowColor=nc;
    rrect(CX,p.x,py,p.w,p.h,p.top?[0,0,10,10]:[10,10,0,0]); CX.stroke();
    CX.shadowBlur=0;
    CX.fillStyle=nc; CX.globalAlpha=.65;
    if(p.top) CX.fillRect(p.x,p.h-5,p.w,5); else CX.fillRect(p.x,H-p.h,p.w,5);
    CX.globalAlpha=1;
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ˜Ğ¡ĞĞ’ĞĞĞ˜Ğ• ĞĞ¢Ğ¡Ğ§ĞĞ¢Ğ Ğ˜ "TAP" ĞĞ CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawOverlayCanvas(){
  const cx=W/2, cy=H/2;

  if(STATE==='countdown'){
    // ĞŸĞ¾Ğ»ÑƒĞ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½
    CX.fillStyle='rgba(0,0,0,.45)';
    CX.fillRect(0,0,W,H);
    // Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾
    const sz=Math.min(W,H)*.28;
    CX.font=`900 ${sz}px Arial, sans-serif`;
    CX.textAlign='center';
    CX.textBaseline='middle';
    // Ğ¢ĞµĞ½ÑŒ-ÑĞ²ĞµÑ‡ĞµĞ½Ğ¸Ğµ
    CX.shadowBlur=60; CX.shadowColor='rgba(241,196,15,.9)';
    CX.fillStyle='#f1c40f';
    CX.fillText(String(cdNum), cx, cy);
    CX.shadowBlur=0;
    // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¿Ñ‚Ğ¸Ñ†Ñ‹ ÑĞ½Ğ¸Ğ·Ñƒ
    const bdef=BIRDS[birdIdx];
    CX.font=`700 ${Math.min(W,H)*.04}px Arial, sans-serif`;
    CX.fillStyle='rgba(255,255,255,.55)';
    CX.fillText(bdef.emoji+' '+bdef.name, cx, cy+sz*.72);
    // ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚ Â«Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒÂ»
    CX.font=`400 ${Math.min(W,H)*.025}px Arial, sans-serif`;
    CX.fillStyle='rgba(255,255,255,.25)';
    CX.fillText('Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ', cx, cy+sz*.72+Math.min(W,H)*.055);
    CX.textAlign='left'; CX.textBaseline='alphabetic';
    return;
  }

  if(STATE==='ready'){
    // ĞœĞ¸Ğ³Ğ°ÑÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°
    tapBlink += .05;
    const alpha = .45+Math.sin(tapBlink)*0.55;
    const fontSize = Math.min(W,H)*.055;
    const text = 'ğŸ‘†  ĞĞĞ–ĞœĞ˜ Ğ§Ğ¢ĞĞ‘Ğ« Ğ›Ğ•Ğ¢Ğ•Ğ¢Ğ¬';
    CX.font=`700 ${fontSize}px Arial, sans-serif`;
    CX.textAlign='center';
    CX.textBaseline='middle';
    // ĞŸĞ»Ğ°ÑˆĞºĞ°
    const tw=CX.measureText(text).width;
    const ph=fontSize*1.5, pw2=tw+fontSize*1.2;
    const bx=cx-pw2/2, by=cy-ph/2;
    CX.fillStyle=`rgba(0,0,0,${alpha*.65})`;
    rrect(CX,bx,by,pw2,ph,ph/2); CX.fill();
    CX.strokeStyle=`rgba(255,255,255,${alpha*.4})`;
    CX.lineWidth=1.5;
    rrect(CX,bx,by,pw2,ph,ph/2); CX.stroke();
    CX.globalAlpha=alpha;
    CX.fillStyle='#fff';
    CX.shadowBlur=18; CX.shadowColor='rgba(255,255,255,.6)';
    CX.fillText(text, cx, cy);
    CX.shadowBlur=0; CX.globalAlpha=1;
    // Ğ˜Ğ¼Ñ Ğ¿Ñ‚Ğ¸Ñ†Ñ‹ Ğ¿Ğ¾Ğ´ Ğ½Ğ°Ğ´Ğ¿Ğ¸ÑÑŒÑ
    const bdef=BIRDS[birdIdx];
    CX.font=`600 ${fontSize*.55}px Arial, sans-serif`;
    CX.fillStyle='rgba(255,255,255,.4)';
    CX.fillText(bdef.emoji+' '+bdef.name, cx, cy+fontSize*1.3);
    CX.textAlign='left'; CX.textBaseline='alphabetic';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ Ğ˜Ğ¡ĞĞ’ĞĞĞ˜Ğ• ĞŸĞ¢Ğ˜Ğ¦Ğ«
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawBird(){
  const b=BIRDS[birdIdx];
  const sc=Math.min(W,H)/520;
  CX.save();
  CX.translate(bird.x,bird.y);
  const angle=Math.min(Math.PI/5,Math.max(-Math.PI/4,bird.v*.07));
  CX.rotate(angle);
  if(b.aura){CX.shadowBlur=18;CX.shadowColor=b.aura;}
  if(combo>=3){CX.shadowBlur=28;CX.shadowColor='#f1c40f';}
  CX.scale(sc,sc);
  const wf=Math.sin(bird.wing)*22;
  CX.fillStyle=b.wing;
  CX.beginPath(); CX.moveTo(-18,2); CX.quadraticCurveTo(0,-wf-24,18,2); CX.fill();
  CX.strokeStyle=b.body; CX.lineWidth=1; CX.globalAlpha=.4;
  for(let f=1;f<=3;f++){
    CX.beginPath(); CX.moveTo(-18+f*9,2);
    CX.quadraticCurveTo(-14+f*9,-wf*.5-f*3,-14+f*9,2); CX.stroke();
  }
  CX.globalAlpha=1;
  CX.fillStyle=b.body;
  CX.beginPath(); CX.ellipse(0,0,25,10,0,0,Math.PI*2); CX.fill();
  CX.fillStyle=b.head; CX.shadowBlur=0;
  CX.beginPath(); CX.arc(17,-4,10,0,Math.PI*2); CX.fill();
  CX.fillStyle=b.beak;
  CX.beginPath(); CX.moveTo(24,-4); CX.lineTo(36,-1); CX.lineTo(24,2); CX.fill();
  CX.fillStyle=b.eye;
  CX.beginPath(); CX.arc(20,-5,3,0,Math.PI*2); CX.fill();
  CX.fillStyle='#fff'; CX.beginPath(); CX.arc(21,-5.8,1.2,0,Math.PI*2); CX.fill();
  CX.fillStyle=b.wing;
  CX.beginPath(); CX.moveTo(-23,0); CX.lineTo(-35,-7); CX.lineTo(-27,3);  CX.fill();
  CX.beginPath(); CX.moveTo(-23,2); CX.lineTo(-33,10); CX.lineTo(-26,5);  CX.fill();
  CX.beginPath(); CX.moveTo(-23,1); CX.lineTo(-36,2);  CX.lineTo(-27,4);  CX.fill();
  if(b.id==='phoenix'){
    CX.globalAlpha=.7;
    ['#ff6b35','#f1c40f','#e74c3c'].forEach((col,ci)=>{
      CX.fillStyle=col;
      CX.beginPath();
      CX.moveTo(-23+ci*3,ci*2);
      CX.quadraticCurveTo(-30+ci*2,-9-Math.sin(frame*.14+ci)*7,-35+ci*3,-4+ci);
      CX.quadraticCurveTo(-28+ci,-2+Math.cos(frame*.14+ci)*4,-23+ci*3,ci*2);
      CX.fill();
    });
    CX.globalAlpha=1;
  }
  CX.restore();
  trails.push({x:bird.x-10,y:bird.y,r:5,life:1});
  if(trails.length>20) trails.shift();
  trails.forEach(t=>t.life-=.06);
  trails=trails.filter(t=>t.life>0);
  trails.forEach(t=>{
    CX.globalAlpha=t.life*.45; CX.fillStyle=b.trail;
    var tr=t.r*t.life; if(tr>0){CX.beginPath(); CX.arc(t.x,t.y,tr,0,Math.PI*2); CX.fill();}
  });
  CX.globalAlpha=1;
}

function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx; p.y+=p.vy; p.vy+=.08;
    p.life-=.03; p.r*=.96;
    if(p.life<=0){particles.splice(i,1);continue;}
    CX.globalAlpha=p.life; CX.fillStyle=p.col;
    if(p.r>0){CX.beginPath(); CX.arc(p.x,p.y,p.r,0,Math.PI*2); CX.fill();}
  }
  CX.globalAlpha=1;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ Ğ•Ğ”ĞŸĞ ĞĞ¡ĞœĞĞ¢Ğ  ĞŸĞ¢Ğ˜Ğ¦Ğ« Ğ’ ĞœĞ•ĞĞ®
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSelector(){
  const grid=document.getElementById('sel-grid');
  grid.innerHTML='';
  BIRDS.forEach((b,i)=>{
    const div=document.createElement('div');
    div.className='sel-card'+(i===0?' active':'');
    const cv=document.createElement('canvas'); cv.width=54; cv.height=54;
    const nm=document.createElement('div'); nm.className='cname'; nm.textContent=b.name;
    const tg=document.createElement('div'); tg.className='ctag';  tg.textContent=b.tag;
    div.append(cv,nm,tg);
    div.onclick=()=>{
      document.querySelectorAll('.sel-card').forEach(c=>c.classList.remove('active'));
      div.classList.add('active');
      birdIdx=i;
    };
    grid.appendChild(div);
    drawPreview(b,cv);
  });
}

function drawPreview(b,cv){
  const c=cv.getContext('2d');
  c.save(); c.translate(27,27);
  c.fillStyle=b.wing; c.beginPath(); c.moveTo(-14,0); c.quadraticCurveTo(0,-20,14,0); c.fill();
  c.fillStyle=b.body; c.beginPath(); c.ellipse(0,0,20,8,0,0,Math.PI*2); c.fill();
  c.fillStyle=b.head; c.beginPath(); c.arc(16,-4,9,0,Math.PI*2); c.fill();
  c.fillStyle=b.beak; c.beginPath(); c.moveTo(22,-4); c.lineTo(32,-1); c.lineTo(22,2); c.fill();
  c.fillStyle=b.eye;  c.beginPath(); c.arc(19,-5,2.5,0,Math.PI*2); c.fill();
  c.fillStyle='#fff'; c.beginPath(); c.arc(20,-5.5,1,0,Math.PI*2); c.fill();
  c.fillStyle=b.wing;
  c.beginPath(); c.moveTo(-20,0); c.lineTo(-30,-5); c.lineTo(-24,2); c.fill();
  c.beginPath(); c.moveTo(-20,2); c.lineTo(-28,8);  c.lineTo(-23,4); c.fill();
  if(b.aura){
    c.shadowBlur=12; c.shadowColor=b.aura;
    c.strokeStyle=b.aura; c.lineWidth=1.5;
    c.beginPath(); c.ellipse(0,0,21,9,0,0,Math.PI*2); c.stroke();
    c.shadowBlur=0;
  }
  c.restore();
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ˜ LEVEL-UP ĞĞ CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawLevelHud(){
  if(STATE!=='playing' && STATE!=='over') return;

  const diff = getDifficulty();
  const fs = Math.min(W,H)*.028;

  // Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ â€” Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹ Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ ÑƒĞ³Ğ¾Ğ» (Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ¼Ğ±Ğ¾)
  CX.save();
  CX.textAlign='right';
  CX.textBaseline='top';
  CX.font='700 '+fs+'px Arial,sans-serif';

  // Ğ¦Ğ²ĞµÑ‚ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ: Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹â†’Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğ¹â†’ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹
  const t=(level-1)/9;
  const r=Math.round(80+t*175), g=Math.round(220-t*120), b=80;
  const col='rgb('+r+','+g+','+b+')';

  CX.fillStyle='rgba(0,0,0,.4)';
  CX.fillRect(W-fs*5.5, fs*.5, fs*5, fs*1.6);

  CX.fillStyle=col;
  CX.shadowBlur=8; CX.shadowColor=col;
  CX.fillText('Ğ£Ğ . '+level+' / 20', W-fs*.6, fs*.7);
  CX.shadowBlur=0;
  CX.restore();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ Ğ¦Ğ˜ĞšĞ›
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loop(){
  cycleDayNight=(cycleDayNight+.00035)%1;
  CX.clearRect(0,0,W,H);

  // Ğ¤Ğ¾Ğ½ Ñ€Ğ¸ÑÑƒĞµÑ‚ÑÑ Ğ²ÑĞµĞ³Ğ´Ğ° (ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾ Ğ·Ğ° Ğ¼ĞµĞ½Ñ Ñ‚Ğ¾Ğ¶Ğµ)
  drawSky();
  drawStars();
  drawCelestial();
  drawMountains();
  drawClouds();

  // Ğ¢Ñ€ÑƒĞ±Ñ‹ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¸Ğ³Ñ€Ğµ Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¼ĞµÑ€Ñ‚Ğ¸
  if(STATE==='playing'||STATE==='over') drawPipes();

  // ĞŸÑ‚Ğ¸Ñ†Ğ° + Ñ‡Ğ°ÑÑ‚Ğ¸Ñ†Ñ‹ â€” Ğ²ÑĞµĞ³Ğ´Ğ° ĞºÑ€Ğ¾Ğ¼Ğµ Ğ¼ĞµĞ½Ñ
  if(STATE!=='menu'){
    if(STATE==='countdown'||STATE==='ready') updateIdle();
    if(STATE==='playing') updateGame();
    drawBird();
    drawParticles();
    drawLevelHud();
    // ĞÑ‚ÑÑ‡Ñ‘Ñ‚/tap â€” Ñ€Ğ¸ÑÑƒĞµĞ¼ ĞĞ canvas Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ²ÑĞµĞ³Ğ¾
    drawOverlayCanvas();
  }

  requestAnimationFrame(loop);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ—ĞĞŸĞ£Ğ¡Ğš
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
resize();
buildSelector();
initWorld();
loop(); // â† Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ñ†Ğ¸ĞºĞ» ÑÑ€Ğ°Ğ·Ñƒ
</script>
</body>
</html>
color: white; margin-bottom: 20px; text-align: center; font-size: 18px; outline: none; width: 200px; }
        input:focus { border-color: var(--gold); }

        .bird-selector { display: flex; gap: 15px; margin-bottom: 30px; }
        .card { background: rgba(30, 41, 59, 0.7); border: 2px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; cursor: pointer; transition: 0.3s; width: 80px; text-align: center; }
        .card:hover { border-color: var(--gold); transform: translateY(-5px); }
        .card span { font-size: 40px; display: block; }

        .leaderboard { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 15px; width: 300px; border: 1px solid rgba(255,255,255,0.1); }
        .lb-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        .lb-row b { color: var(--gold); }

        #score-ui { position: fixed; top: 40px; width: 100%; text-align: center; font-size: 60px; font-weight: 900; z-index: 100; pointer-events: none; text-shadow: 0 4px 20px #000; }
        #timer { position: fixed; top: 35%; width: 100%; text-align: center; font-size: 80px; color: var(--gold); z-index: 150; font-weight: 900; }

        .btn-box { display: flex; gap: 15px; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-res { background: #10b981; color: white; }
        .btn-menu { background: #334155; color: white; }
    </style>
</head>
<body>

    <div id="score-ui">0</div>
    <div id="timer"></div>

    <div id="menu" class="overlay">
        <h1>EAGLE STORM</h1>
        <input type="text" id="player-name" placeholder="Ğ¢Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ" maxlength="12">
        <div class="bird-selector">
            <div class="card" onclick="selectBird('#3e2723', '#fff')"><span>ğŸ¦…</span>ĞĞ Ğ•Ğ›</div>
            <div class="card" onclick="selectBird('#e67e22', '#f1c40f')"><span>ğŸ”¥</span>Ğ¤Ğ•ĞĞ˜ĞšĞ¡</div>
            <div class="card" onclick="selectBird('#1e293b', '#6366f1')"><span>ğŸ¦</span>Ğ’ĞĞ ĞĞ</div>
        </div>
        <div class="leaderboard" id="main-lb"></div>
    </div>

    <div id="game-over" class="overlay" style="display:none">
        <h2 style="color:#ef4444">Ğ¡Ğ¢ĞĞ›ĞšĞĞĞ’Ğ•ĞĞ˜Ğ•</h2>
        <div id="last-score" style="margin: 10px 0; font-size: 20px;">Ğ¡Ñ‡ĞµÑ‚: 0</div>
        <div class="leaderboard" id="death-lb"></div>
        <div class="btn-box">
            <button class="btn btn-res" onclick="restart()">Ğ Ğ•Ğ¡Ğ¢ĞĞ Ğ¢</button>
            <button class="btn btn-menu" onclick="location.reload()">ĞœĞ•ĞĞ®</button>
        </div>
    </div>

    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const timerUI = document.getElementById('timer');
const scoreUI = document.getElementById('score-ui');
const nameInput = document.getElementById('player-name');

let w, h, bird, pipes = [], clouds = [], stars = [], score = 0, frame = 0;
let gameStarted = false, isOver = false, birdSelected = false;
let birdBody = '#3e2723', birdHead = '#fff';
let cycle = 0; // 0-1: Ğ´ĞµĞ½ÑŒ, Ğ·Ğ°ĞºĞ°Ñ‚, Ğ½Ğ¾Ñ‡ÑŒ, Ñ€Ğ°ÑÑĞ²ĞµÑ‚
let lightning = 0;

const GRAVITY = 0.17;
const JUMP = -4.8;
const SPEED = 3.5;

function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.onresize = resize;
resize();

function initGame() {
    bird = { x: w * 0.25, y: h / 2, v: 0, a: 0, wing: 0 };
    pipes = [];
    clouds = [];
    stars = [];
    for(let i=0; i<80; i++) stars.push({x: Math.random()*w, y: Math.random()*h, s: Math.random()});
    for(let i=0; i<6; i++) clouds.push({x: Math.random()*w, y: Math.random()*h*0.5, s: 0.4 + Math.random()});
}
initGame();

function selectBird(body, head) {
    if(!nameInput.value.trim()) { alert("Ğ’Ğ²ĞµĞ´Ğ¸ Ğ¸Ğ¼Ñ!"); return; }
    birdBody = body; birdHead = head;
    birdSelected = true;
    document.getElementById('menu').style.display = 'none';
    scoreUI.style.display = 'block';
    
    let count = 3;
    timerUI.innerText = "Ğ“ĞĞ¢ĞĞ’Ğ¬Ğ¡Ğ¯...";
    let t = setInterval(() => {
        if(count <= 0) {
            clearInterval(t);
            timerUI.innerText = "Ğ’ ĞŸĞĞ›Ğ•Ğ¢!";
            setTimeout(() => timerUI.innerText = "", 800);
            gameStarted = true;
        } else {
            timerUI.innerText = count;
            count--;
        }
    }, 1000);
}

function drawBird() {
    ctx.save();
    ctx.translate(bird.x, bird.y);
    bird.a = Math.min(Math.PI/6, Math.max(-Math.PI/6, bird.v * 0.08));
    ctx.rotate(bird.a);
    
    ctx.fillStyle = birdBody;
    let sw = Math.sin(bird.wing) * 22;
    ctx.beginPath(); ctx.moveTo(-15, 0); ctx.quadraticCurveTo(0, -sw - 25, 15, 0); ctx.fill();
    ctx.beginPath(); ctx.ellipse(0, 0, 26, 11, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = birdHead;
    ctx.beginPath(); ctx.arc(17, -4, 10, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#f59e0b';
    ctx.beginPath(); ctx.moveTo(24, -4); ctx.lineTo(35, -1); ctx.lineTo(24, 2); ctx.fill();
    ctx.restore();
}

function update() {
    if (!birdSelected || isOver) return;

    // Ğ¦Ğ¸ĞºĞ» Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº (Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹)
    cycle = (Math.sin(frame * 0.001) + 1) / 2; // 0 - Ğ½Ğ¾Ñ‡ÑŒ, 1 - Ğ´ĞµĞ½ÑŒ

    // Ğ Ğ°Ğ½Ğ´Ğ¾Ğ¼Ğ½Ğ°Ñ Ğ³Ñ€Ğ¾Ğ·Ğ°
    if(gameStarted && Math.random() < 0.002 && lightning <= 0) lightning = 10;
    if(lightning > 0) lightning--;

    if (!gameStarted) {
        bird.y = h/2 + Math.sin(frame*0.06)*15;
        bird.wing += 0.1;
    } else {
        bird.v += GRAVITY;
        bird.y += bird.v;
        bird.wing += 0.15;

        if(frame % 130 === 0) {
            let gap = 260 - Math.min(score, 50); // Ğ£ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ: Ğ¿Ñ€Ğ¾ÑĞ²ĞµÑ‚ ÑÑƒĞ¶Ğ°ĞµÑ‚ÑÑ
            let th = 100 + Math.random() * (h - gap - 200);
            pipes.push({x: w, w: 100, h: th, type: 'top', passed: false});
            pipes.push({x: w, w: 100, h: h - th - gap, type: 'bot'});
        }

        pipes.forEach((p, i) => {
            p.x -= SPEED + (score * 0.02); // Ğ£ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ: ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ñ€Ğ°ÑÑ‚ĞµÑ‚
            if(bird.x + 18 > p.x && bird.x - 18 < p.x + p.w) {
                if(p.type === 'top' && bird.y - 12 < p.h) die();
                if(p.type === 'bot' && bird.y + 12 > h - p.h) die();
            }
            if(!p.passed && p.type === 'top' && p.x < bird.x) {
                score++; p.passed = true;
                scoreUI.innerText = score;
            }
            if(p.x < -120) pipes.splice(i, 1);
        });

        if(bird.y > h || bird.y < 0) die();
    }
    frame++;
}

function die() {
    isOver = true;
    saveScore(nameInput.value, score);
    document.getElementById('last-score').innerText = nameInput.value + ": " + score;
    renderLB();
    document.getElementById('game-over').style.display = 'flex';
}

function restart() {
    document.getElementById('game-over').style.display = 'none';
    isOver = false; gameStarted = false; score = 0; scoreUI.innerText = "0";
    initGame();
    selectBird(birdBody, birdHead);
}

function saveScore(name, s) {
    let sc = JSON.parse(localStorage.getItem('bird_storm_v4') || "[]");
    sc.push({name, s});
    sc.sort((a,b)=>b.s-a.s);
    localStorage.setItem('bird_storm_v4', JSON.stringify(sc.slice(0, 5)));
}

function renderLB() {
    let sc = JSON.parse(localStorage.getItem('bird_storm_v4') || "[]");
    let html = `<b>Ğ¢ĞĞŸ Ğ›Ğ•Ğ¢Ğ§Ğ˜ĞšĞĞ’:</b>` + sc.map((item, i) => `
        <div class="lb-row"><span>${i+1}. ${item.name}</span> <b>${item.s}</b></div>
    `).join('');
    document.getElementById('main-lb').innerHTML = html;
    document.getElementById('death-lb').innerHTML = html;
}

function loop() {
    // Ğ¤Ğ¾Ğ½ Ğ´Ğ½Ñ Ğ¸ Ğ½Ğ¾Ñ‡Ğ¸
    let dayCol = [30, 101, 192]; // Ğ“Ğ¾Ğ»ÑƒĞ±Ğ¾Ğ¹
    let nightCol = [10, 15, 30];  // Ğ¢ĞµĞ¼Ğ½Ğ¾-ÑĞ¸Ğ½Ğ¸Ğ¹
    let r = Math.round(nightCol[0] + (dayCol[0] - nightCol[0]) * cycle);
    let g = Math.round(nightCol[1] + (dayCol[1] - nightCol[1]) * cycle);
    let b = Math.round(nightCol[2] + (dayCol[2] - nightCol[2]) * cycle);
    
    ctx.fillStyle = `rgb(${r},${g},${b})`;
    if(lightning > 0) ctx.fillStyle = '#fff'; // Ğ’ÑĞ¿Ñ‹ÑˆĞºĞ° Ğ¼Ğ¾Ğ»Ğ½Ğ¸Ğ¸
    ctx.fillRect(0,0,w,h);

    // Ğ—Ğ²ĞµĞ·Ğ´Ñ‹ (Ğ²Ğ¸Ğ´Ğ½Ñ‹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ¾Ñ‡ÑŒÑ)
    ctx.fillStyle = `rgba(255,255,255,${1 - cycle})`;
    stars.forEach(s => {
        ctx.beginPath(); ctx.arc(s.x, s.y, s.s * 2, 0, Math.PI*2); ctx.fill();
    });

    // ĞĞ±Ğ»Ğ°ĞºĞ°
    ctx.fillStyle = `rgba(255,255,255,${0.1 * cycle + 0.02})`;
    clouds.forEach(c => {
        c.x -= SPEED * 0.2 * c.s;
        if(c.x < -150) c.x = w + 150;
        ctx.beginPath(); ctx.arc(c.x, c.y, 60 * c.s, 0, Math.PI*2); ctx.fill();
    });

    // Ğ¡ĞºĞ°Ğ»Ñ‹
    pipes.forEach(p => {
        // ĞĞ¾Ñ‡ÑŒÑ ÑĞºĞ°Ğ»Ñ‹ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‡Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ½ĞµĞ¾Ğ½Ğ¾Ğ¼
        ctx.fillStyle = cycle < 0.3 ? '#1e293b' : '#0f172a';
        ctx.strokeStyle = cycle < 0.3 ? '#3498db' : 'transparent';
        ctx.lineWidth = 2;
        ctx.fillRect(p.x, p.type === 'top' ? 0 : h - p.h, p.w, p.h);
        if(cycle < 0.3) ctx.strokeRect(p.x, p.type === 'top' ? 0 : h - p.h, p.w, p.h);
        
        ctx.fillStyle = cycle < 0.3 ? '#3498db' : '#f8fafc';
        ctx.fillRect(p.x, p.type === 'top' ? p.h - 5 : h - p.h, p.w, 5);
    });

    drawBird();
    update();
    requestAnimationFrame(loop);
}

canvas.addEventListener('touchstart', (e) => { 
    if(gameStarted && !isOver) bird.v = JUMP; 
    e.preventDefault();
}, {passive: false});

window.onkeydown = (e) => { if(e.code === 'Space' && gameStarted && !isOver) bird.v = JUMP; };

renderLB();
loop();
</script>
</body>
</html>


