<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eagle Storm: Day & Night Edition</title>
    <style>
        :root { --gold: #f1c40f; --bg: #020617; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Inter', sans-serif; touch-action: none; color: white; }
        canvas { display: block; }
        
        .overlay { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; background: rgba(2, 6, 23, 0.85); backdrop-filter: blur(12px); }
        
        #menu h1 { font-size: clamp(30px, 8vw, 48px); letter-spacing: 5px; margin-bottom: 20px; background: linear-gradient(45deg, #f1c40f, #e67e22); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        input { padding: 12px 20px; border-radius: 10px; border: 1px solid #334155; background: rgba(255,255,255,0.05); color: white; margin-bottom: 20px; text-align: center; font-size: 18px; outline: none; width: 200px; }
        input:focus { border-color: var(--gold); }

        .bird-selector { display: flex; gap: 15px; margin-bottom: 30px; }
        .card { background: rgba(30, 41, 59, 0.7); border: 2px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; cursor: pointer; transition: 0.3s; width: 80px; text-align: center; }
        .card:hover { border-color: var(--gold); transform: translateY(-5px); }
        .card span { font-size: 40px; display: block; }

        .leaderboard { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 15px; width: 300px; border: 1px solid rgba(255,255,255,0.1); }
        .lb-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        .lb-row b { color: var(--gold); }

        #score-ui { position: fixed; top: 40px; width: 100%; text-align: center; font-size: 60px; font-weight: 900; z-index: 100; pointer-events: none; text-shadow: 0 4px 20px #000; }
        #timer { position: fixed; top: 35%; width: 100%; text-align: center; font-size: 80px; color: var(--gold); z-index: 150; font-weight: 900; }

        .btn-box { display: flex; gap: 15px; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-res { background: #10b981; color: white; }
        .btn-menu { background: #334155; color: white; }
    </style>
</head>
<body>

    <div id="score-ui">0</div>
    <div id="timer"></div>

    <div id="menu" class="overlay">
        <h1>EAGLE STORM</h1>
        <input type="text" id="player-name" placeholder="–¢–≤–æ–µ –∏–º—è" maxlength="12">
        <div class="bird-selector">
            <div class="card" onclick="selectBird('#3e2723', '#fff')"><span>ü¶Ö</span>–û–†–ï–õ</div>
            <div class="card" onclick="selectBird('#e67e22', '#f1c40f')"><span>üî•</span>–§–ï–ù–ò–ö–°</div>
            <div class="card" onclick="selectBird('#1e293b', '#6366f1')"><span>üê¶</span>–í–û–†–û–ù</div>
        </div>
        <div class="leaderboard" id="main-lb"></div>
    </div>

    <div id="game-over" class="overlay" style="display:none">
        <h2 style="color:#ef4444">–°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ï</h2>
        <div id="last-score" style="margin: 10px 0; font-size: 20px;">–°—á–µ—Ç: 0</div>
        <div class="leaderboard" id="death-lb"></div>
        <div class="btn-box">
            <button class="btn btn-res" onclick="restart()">–†–ï–°–¢–ê–†–¢</button>
            <button class="btn btn-menu" onclick="location.reload()">–ú–ï–ù–Æ</button>
        </div>
    </div>

    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const timerUI = document.getElementById('timer');
const scoreUI = document.getElementById('score-ui');
const nameInput = document.getElementById('player-name');

let w, h, bird, pipes = [], clouds = [], stars = [], score = 0, frame = 0;
let gameStarted = false, isOver = false, birdSelected = false;
let birdBody = '#3e2723', birdHead = '#fff';
let cycle = 0; // 0-1: –¥–µ–Ω—å, –∑–∞–∫–∞—Ç, –Ω–æ—á—å, —Ä–∞—Å—Å–≤–µ—Ç
let lightning = 0;

const GRAVITY = 0.17;
const JUMP = -4.8;
const SPEED = 3.5;

function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.onresize = resize;
resize();

function initGame() {
    bird = { x: w * 0.25, y: h / 2, v: 0, a: 0, wing: 0 };
    pipes = [];
    clouds = [];
    stars = [];
    for(let i=0; i<80; i++) stars.push({x: Math.random()*w, y: Math.random()*h, s: Math.random()});
    for(let i=0; i<6; i++) clouds.push({x: Math.random()*w, y: Math.random()*h*0.5, s: 0.4 + Math.random()});
}
initGame();

function selectBird(body, head) {
    if(!nameInput.value.trim()) { alert("–í–≤–µ–¥–∏ –∏–º—è!"); return; }
    birdBody = body; birdHead = head;
    birdSelected = true;
    document.getElementById('menu').style.display = 'none';
    scoreUI.style.display = 'block';
    
    let count = 3;
    timerUI.innerText = "–ì–û–¢–û–í–¨–°–Ø...";
    let t = setInterval(() => {
        if(count <= 0) {
            clearInterval(t);
            timerUI.innerText = "–í –ü–û–õ–ï–¢!";
            setTimeout(() => timerUI.innerText = "", 800);
            gameStarted = true;
        } else {
            timerUI.innerText = count;
            count--;
        }
    }, 1000);
}

function drawBird() {
    ctx.save();
    ctx.translate(bird.x, bird.y);
    bird.a = Math.min(Math.PI/6, Math.max(-Math.PI/6, bird.v * 0.08));
    ctx.rotate(bird.a);
    
    ctx.fillStyle = birdBody;
    let sw = Math.sin(bird.wing) * 22;
    ctx.beginPath(); ctx.moveTo(-15, 0); ctx.quadraticCurveTo(0, -sw - 25, 15, 0); ctx.fill();
    ctx.beginPath(); ctx.ellipse(0, 0, 26, 11, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = birdHead;
    ctx.beginPath(); ctx.arc(17, -4, 10, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#f59e0b';
    ctx.beginPath(); ctx.moveTo(24, -4); ctx.lineTo(35, -1); ctx.lineTo(24, 2); ctx.fill();
    ctx.restore();
}

function update() {
    if (!birdSelected || isOver) return;

    // –¶–∏–∫–ª –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ (–º–µ–¥–ª–µ–Ω–Ω—ã–π)
    cycle = (Math.sin(frame * 0.001) + 1) / 2; // 0 - –Ω–æ—á—å, 1 - –¥–µ–Ω—å

    // –†–∞–Ω–¥–æ–º–Ω–∞—è –≥—Ä–æ–∑–∞
    if(gameStarted && Math.random() < 0.002 && lightning <= 0) lightning = 10;
    if(lightning > 0) lightning--;

    if (!gameStarted) {
        bird.y = h/2 + Math.sin(frame*0.06)*15;
        bird.wing += 0.1;
    } else {
        bird.v += GRAVITY;
        bird.y += bird.v;
        bird.wing += 0.15;

        if(frame % 130 === 0) {
            let gap = 260 - Math.min(score, 50); // –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ: –ø—Ä–æ—Å–≤–µ—Ç —Å—É–∂–∞–µ—Ç—Å—è
            let th = 100 + Math.random() * (h - gap - 200);
            pipes.push({x: w, w: 100, h: th, type: 'top', passed: false});
            pipes.push({x: w, w: 100, h: h - th - gap, type: 'bot'});
        }

        pipes.forEach((p, i) => {
            p.x -= SPEED + (score * 0.02); // –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ: —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç
            if(bird.x + 18 > p.x && bird.x - 18 < p.x + p.w) {
                if(p.type === 'top' && bird.y - 12 < p.h) die();
                if(p.type === 'bot' && bird.y + 12 > h - p.h) die();
            }
            if(!p.passed && p.type === 'top' && p.x < bird.x) {
                score++; p.passed = true;
                scoreUI.innerText = score;
            }
            if(p.x < -120) pipes.splice(i, 1);
        });

        if(bird.y > h || bird.y < 0) die();
    }
    frame++;
}

function die() {
    isOver = true;
    saveScore(nameInput.value, score);
    document.getElementById('last-score').innerText = nameInput.value + ": " + score;
    renderLB();
    document.getElementById('game-over').style.display = 'flex';
}

function restart() {
    document.getElementById('game-over').style.display = 'none';
    isOver = false; gameStarted = false; score = 0; scoreUI.innerText = "0";
    initGame();
    selectBird(birdBody, birdHead);
}

function saveScore(name, s) {
    let sc = JSON.parse(localStorage.getItem('bird_storm_v4') || "[]");
    sc.push({name, s});
    sc.sort((a,b)=>b.s-a.s);
    localStorage.setItem('bird_storm_v4', JSON.stringify(sc.slice(0, 5)));
}

function renderLB() {
    let sc = JSON.parse(localStorage.getItem('bird_storm_v4') || "[]");
    let html = `<b>–¢–û–ü –õ–ï–¢–ß–ò–ö–û–í:</b>` + sc.map((item, i) => `
        <div class="lb-row"><span>${i+1}. ${item.name}</span> <b>${item.s}</b></div>
    `).join('');
    document.getElementById('main-lb').innerHTML = html;
    document.getElementById('death-lb').innerHTML = html;
}

function loop() {
    // –§–æ–Ω –¥–Ω—è –∏ –Ω–æ—á–∏
    let dayCol = [30, 101, 192]; // –ì–æ–ª—É–±–æ–π
    let nightCol = [10, 15, 30];  // –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π
    let r = Math.round(nightCol[0] + (dayCol[0] - nightCol[0]) * cycle);
    let g = Math.round(nightCol[1] + (dayCol[1] - nightCol[1]) * cycle);
    let b = Math.round(nightCol[2] + (dayCol[2] - nightCol[2]) * cycle);
    
    ctx.fillStyle = `rgb(${r},${g},${b})`;
    if(lightning > 0) ctx.fillStyle = '#fff'; // –í—Å–ø—ã—à–∫–∞ –º–æ–ª–Ω–∏–∏
    ctx.fillRect(0,0,w,h);

    // –ó–≤–µ–∑–¥—ã (–≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ—á—å—é)
    ctx.fillStyle = `rgba(255,255,255,${1 - cycle})`;
    stars.forEach(s => {
        ctx.beginPath(); ctx.arc(s.x, s.y, s.s * 2, 0, Math.PI*2); ctx.fill();
    });

    // –û–±–ª–∞–∫–∞
    ctx.fillStyle = `rgba(255,255,255,${0.1 * cycle + 0.02})`;
    clouds.forEach(c => {
        c.x -= SPEED * 0.2 * c.s;
        if(c.x < -150) c.x = w + 150;
        ctx.beginPath(); ctx.arc(c.x, c.y, 60 * c.s, 0, Math.PI*2); ctx.fill();
    });

    // –°–∫–∞–ª—ã
    pipes.forEach(p => {
        // –ù–æ—á—å—é —Å–∫–∞–ª—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è –Ω–µ–æ–Ω–æ–º
        ctx.fillStyle = cycle < 0.3 ? '#1e293b' : '#0f172a';
        ctx.strokeStyle = cycle < 0.3 ? '#3498db' : 'transparent';
        ctx.lineWidth = 2;
        ctx.fillRect(p.x, p.type === 'top' ? 0 : h - p.h, p.w, p.h);
        if(cycle < 0.3) ctx.strokeRect(p.x, p.type === 'top' ? 0 : h - p.h, p.w, p.h);
        
        ctx.fillStyle = cycle < 0.3 ? '#3498db' : '#f8fafc';
        ctx.fillRect(p.x, p.type === 'top' ? p.h - 5 : h - p.h, p.w, 5);
    });

    drawBird();
    update();
    requestAnimationFrame(loop);
}

canvas.addEventListener('touchstart', (e) => { 
    if(gameStarted && !isOver) bird.v = JUMP; 
    e.preventDefault();
}, {passive: false});

window.onkeydown = (e) => { if(e.code === 'Space' && gameStarted && !isOver) bird.v = JUMP; };

renderLB();
loop();
</script>
</body>
</html>
